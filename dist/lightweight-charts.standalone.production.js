/*!
 * @license
 * TradingView Lightweight Charts v4.0.0-dev+202206071405
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function s(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function e(t,i,s,e){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(s,i+n),t.lineTo(e,i+n),t.stroke()}function n(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function h(t){if(void 0===t)throw new Error("Value is undefined");return t}function r(t){if(null===t)throw new Error("Value is null");return t}function l(t){return r(h(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));const a={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function o(t){return t<0?0:t>255?255:Math.round(t)||0}function u(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,_=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,f=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function p(t){(t=t.toLowerCase())in a&&(t=a[t]);{const i=f.exec(t)||d.exec(t);if(i)return[o(parseInt(i[1],10)),o(parseInt(i[2],10)),o(parseInt(i[3],10)),u(i.length<5?1:parseFloat(i[4]))]}{const i=_.exec(t);if(i)return[o(parseInt(i[1],16)),o(parseInt(i[2],16)),o(parseInt(i[3],16)),1]}{const i=c.exec(t);if(i)return[o(17*parseInt(i[1],16)),o(17*parseInt(i[2],16)),o(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function v(t){const i=p(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class m{constructor(){this.h=[]}subscribe(t,i,s){const e={l:t,o:i,u:!0===s};this.h.push(e)}unsubscribe(t){const i=this.h.findIndex((i=>t===i.l));i>-1&&this.h.splice(i,1)}unsubscribeAll(t){this.h=this.h.filter((i=>i.o!==t))}_(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.l(t,i)))}p(){return this.h.length>0}v(){this.h=[]}}function w(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:w(t[i],s[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function b(t){return"number"==typeof t&&t%1==0}function M(t){return"string"==typeof t}function S(t){return"boolean"==typeof t}function y(t){const i=t;if(!i||"object"!=typeof i)return i;let s,e,n;for(e in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(e)&&(n=i[e],s[e]=n&&"object"==typeof n?y(n):n);return s}function k(t){return null!==t}function x(t){return null===t?void 0:t}const C="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function T(t,i,s){return void 0===i&&(i=C),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class P{constructor(t){this.m={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this.g=t}options(){const t=this.m,i=this.M(),s=this.S();return t.fontSize===i&&t.fontFamily===s||(t.fontSize=i,t.fontFamily=s,t.font=T(i,s),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/10)),t.color=this.k(),this.m}k(){return this.g.options().layout.textColor}M(){return this.g.options().layout.fontSize}S(){return this.g.options().layout.fontFamily}}class D{constructor(){this.C=[]}T(t){this.C=t}draw(t,i,s,e){this.C.forEach((n=>{t.save(),n.draw(t,i,s,e),t.restore()}))}}class O{draw(t,i,s,e){t.save(),t.scale(i,i),this.P(t,s,e),t.restore()}drawBackground(t,i,s,e){t.save(),t.scale(i,i),this.D(t,s,e),t.restore()}D(t,i,s){}}class E extends O{constructor(){super(...arguments),this.O=null}N(t){this.O=t}P(t){if(null===this.O||null===this.O.R)return;const i=this.O.R,s=this.O,e=e=>{t.beginPath();for(let n=i.to-1;n>=i.from;--n){const i=s.A[n];t.moveTo(i.x,i.y),t.arc(i.x,i.y,e,0,2*Math.PI)}t.fill()};t.fillStyle=s.L,e(s.I+2),t.fillStyle=s.V,e(s.I)}}function N(){return{A:[{x:0,y:0,time:0,price:0}],V:"",L:"",I:0,R:null}}const R={from:0,to:1};class A{constructor(t,i){this.B=new D,this.F=[],this.W=[],this.j=!0,this.g=t,this.$=i,this.B.T(this.F)}update(t){const i=this.g.serieses();i.length!==this.F.length&&(this.W=i.map(N),this.F=this.W.map((t=>{const i=new E;return i.N(t),i})),this.B.T(this.F)),this.j=!0}renderer(t,i,s){return this.j&&(this.H(t),this.j=!1),this.B}H(t){const i=this.g.serieses(),s=this.$.appliedIndex(),e=this.g.timeScale();i.forEach(((i,n)=>{var h;const l=this.W[n],a=i.markerDataAtIndex(s);if(null===a||!i.visible())return void(l.R=null);const o=r(i.firstValue());l.V=a.backgroundColor,l.I=a.radius,l.A[0].price=a.price,l.A[0].y=i.priceScale().priceToCoordinate(a.price,o.value),l.L=null!==(h=a.borderColor)&&void 0!==h?h:this.g.backgroundColorAtYPercentFromTop(l.A[0].y/t),l.A[0].time=s,l.A[0].x=e.indexToCoordinate(s),l.R=R}))}}class L{constructor(t){this.U=t}draw(t,i,n,h){if(null===this.U)return;const r=this.U.Y.q,l=this.U.X.q;if(!r&&!l)return;t.save();const a=Math.round(this.U.K*i),o=Math.round(this.U.Z*i),u=Math.ceil(this.U.G*i),c=Math.ceil(this.U.J*i);t.lineCap="butt",r&&a>=0&&(t.lineWidth=Math.floor(this.U.Y.tt*i),t.strokeStyle=this.U.Y.it,t.fillStyle=this.U.Y.it,s(t,this.U.Y.st),function(t,i,s,e){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(i+n,s),t.lineTo(i+n,e),t.stroke()}(t,a,0,c)),l&&o>=0&&(t.lineWidth=Math.floor(this.U.X.tt*i),t.strokeStyle=this.U.X.it,t.fillStyle=this.U.X.it,s(t,this.U.X.st),e(t,o,0,u)),t.restore()}}class I{constructor(t){this.j=!0,this.et={Y:{tt:1,st:0,it:"",q:!1},X:{tt:1,st:0,it:"",q:!1},G:0,J:0,K:0,Z:0},this.nt=new L(this.et),this.ht=t}rt(){this.j=!0}renderer(t,i){return this.j&&(this.H(),this.j=!1),this.nt}H(){const t=this.ht.visible(),i=r(this.ht.pane()),s=i.model().options().crosshair,e=this.et;e.X.q=t&&this.ht.horzLineVisible(i),e.Y.q=t&&this.ht.vertLineVisible(),e.X.tt=s.horzLine.width,e.X.st=s.horzLine.style,e.X.it=s.horzLine.color,e.Y.tt=s.vertLine.width,e.Y.st=s.vertLine.style,e.Y.it=s.vertLine.color,e.G=i.width(),e.J=i.height(),e.K=this.ht.appliedX(),e.Z=this.ht.appliedY()}}function V(t,i,s,e,n,h){t.fillRect(i+h,s,e-2*h,h),t.fillRect(i+h,s+n-h,e-2*h,h),t.fillRect(i,s,h,n),t.fillRect(i+e-h,s,h,n)}function B(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function F(t,i,s,e,n,h){t.save(),t.globalCompositeOperation="copy",t.fillStyle=h,t.fillRect(i,s,e,n),t.restore()}function z(t,i,s,e,n,h,r){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,n);l.addColorStop(0,h),l.addColorStop(1,r),t.fillStyle=l,t.fillRect(i,s,e,n),t.restore()}class W{constructor(t,i){this.setData(t,i)}setData(t,i){this.U=t,this.lt=i}draw(t,i,s,e,n,h){if(!this.U.visible)return;t.font=i.font;const r=this.U.tickVisible||!this.U.moveTextToInvisibleTick?i.tickLength:0,l=i.borderSize,a=i.paddingTop,o=i.paddingBottom,u=i.paddingInner,c=i.paddingOuter,_=this.U.text,d=Math.ceil(s.measureText(t,_)),f=i.baselineOffset,p=i.fontSize+a+o,v=Math.ceil(.5*p),m=l+d+u+c+r;let w=this.lt.coordinate;this.lt.fixedCoordinate&&(w=this.lt.fixedCoordinate),w=Math.round(w);const g=w-v,b=g+p,M="right"===n,S=M?e:0,y=Math.ceil(e*h);let k,x,C=S;if(t.fillStyle=this.lt.background,t.lineWidth=1,t.lineCap="butt",_){M?(C=S-m,k=S-r,x=C+c):(C=S+m,k=S+r,x=S+l+r+u);const i=Math.max(1,Math.floor(h)),s=Math.max(1,Math.floor(l*h)),e=M?y:0,n=Math.round(g*h),a=Math.round(C*h),d=Math.round(w*h)-Math.floor(.5*h),p=d+i+(d-n),v=Math.round(k*h);t.save(),t.beginPath(),t.moveTo(e,n),t.lineTo(a,n),t.lineTo(a,p),t.lineTo(e,p),t.fill(),t.fillStyle=this.U.borderColor,t.fillRect(M?y-s:0,n,s,p-n),this.U.tickVisible&&(t.fillStyle=this.lt.color,t.fillRect(e,d,v-e,i)),t.textAlign="left",t.fillStyle=this.lt.color,B(t,h,(()=>{t.fillText(_,x,b-o-f)})),t.restore()}}height(t,i){return this.U.visible?t.fontSize+t.paddingTop+t.paddingBottom:0}}class j{constructor(t){this.ot={coordinate:0,color:"#FFF",background:"#000"},this.ut={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this.ct={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this.j=!0,this._t=new(t||W)(this.ut,this.ot),this.dt=new(t||W)(this.ct,this.ot)}text(){return this.ft(),this.ut.text}coordinate(){return this.ft(),this.ot.coordinate}update(){this.j=!0}height(t,i=!1){return Math.max(this._t.height(t,i),this.dt.height(t,i))}getFixedCoordinate(){return this.ot.fixedCoordinate||0}setFixedCoordinate(t){this.ot.fixedCoordinate=t}isVisible(){return this.ft(),this.ut.visible||this.ct.visible}isAxisLabelVisible(){return this.ft(),this.ut.visible}renderer(t){return this.ft(),this.ut.tickVisible=this.ut.tickVisible&&t.options().ticksVisible,this.ct.tickVisible=this.ct.tickVisible&&t.options().ticksVisible,this._t.setData(this.ut,this.ot),this.dt.setData(this.ct,this.ot),this._t}paneRenderer(){return this.ft(),this._t.setData(this.ut,this.ot),this.dt.setData(this.ct,this.ot),this.dt}ft(){this.j&&(this.ut.tickVisible=!0,this.ct.tickVisible=!1,this.vt(this.ut,this.ct,this.ot))}}class $ extends j{constructor(t,i,s){super(),this.ht=t,this.wt=i,this.gt=s}vt(t,i,s){t.visible=!1;const e=this.ht.options().horzLine;if(!e.labelVisible)return;const n=this.wt.firstValue();if(!this.ht.visible()||this.wt.isEmpty()||null===n)return;const h=v(e.labelBackgroundColor);s.background=h.t,s.color=h.i;const r=this.gt(this.wt);s.coordinate=r.bt,t.text=this.wt.formatPrice(r.Mt,n),t.visible=!0}}const H=/[1-9]/g;class U{constructor(){this.U=null}setData(t){this.U=t}draw(t,i,s){if(null===this.U||!1===this.U.visible||0===this.U.text.length)return;t.font=i.font;const e=Math.round(i.widthCache.measureText(t,this.U.text,H));if(e<=0)return;t.save();const n=i.paddingHorizontal,h=e+2*n,l=h/2,a=this.U.width;let o=this.U.coordinate,u=Math.floor(o-l)+.5;u<0?(o+=Math.abs(0-u),u=Math.floor(o-l)+.5):u+h>a&&(o-=Math.abs(a-(u+h)),u=Math.floor(o-l)+.5);const c=u+h,_=0+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.U.background;const d=Math.round(u*s),f=Math.round(0*s),p=Math.round(c*s),v=Math.round(_*s);if(t.fillRect(d,f,p-d,v-f),this.U.tickVisible){const e=Math.round(this.U.coordinate*s),n=f,h=Math.round((n+i.borderSize+i.tickLength)*s);t.fillStyle=this.U.color;const r=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(e-l,n,r,h-n)}const m=_-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.U.color,B(t,s,(()=>{t.fillText(r(this.U).text,u+n,m)})),t.restore()}}class q{constructor(t,i,s){this.j=!0,this.nt=new U,this.et={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN,tickVisible:!0},this.$=t,this.St=i,this.gt=s}rt(){this.j=!0}renderer(){return this.j&&(this.H(),this.j=!1),this.nt.setData(this.et),this.nt}H(){const t=this.et;t.visible=!1;const i=this.$.options().vertLine;if(!i.labelVisible)return;const s=this.St.timeScale();if(s.isEmpty())return;t.width=s.width();const e=this.gt();if(!e.yt)return;t.coordinate=e.bt;const n=s.indexToTimeScalePoint(this.$.appliedIndex());t.text=s.formatDateTime(r(n)),t.visible=!0;const h=v(i.labelBackgroundColor);t.background=h.t,t.color=h.i,t.tickVisible=s.options().ticksVisible}}class Y{constructor(){this._priceScale=null,this.kt=0}zorder(){return this.kt}setZorder(t){this.kt=t}priceScale(){return this._priceScale}setPriceScale(t){this._priceScale=t}labelPaneViews(t){return[]}timeAxisViews(){return[]}visible(){return!0}}var X;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(X||(X={}));class K extends Y{constructor(t,i){super(),this.xt=null,this.Ct=NaN,this.Tt=0,this.Pt=!0,this.Dt=new Map,this.Ot=!1,this.Et=NaN,this.Nt=NaN,this.Rt=NaN,this.At=NaN,this.St=t,this.Lt=i,this.It=new A(t,this);this.Vt=((t,i)=>s=>{const e=i(),n=t();if(s===r(this.xt).defaultPriceScale())return{Mt:n,bt:e};{const t=r(s.firstValue());return{Mt:s.coordinateToPrice(e,t),bt:e}}})((()=>this.Ct),(()=>this.Nt));const s=((t,i)=>()=>({yt:this.St.timeScale().indexToTime(t()),bt:i()}))((()=>this.Tt),(()=>this.appliedX()));this.Bt=new q(this,t,s),this.Ft=new I(this)}options(){return this.Lt}saveOriginCoord(t,i){this.Rt=t,this.At=i}clearOriginCoord(){this.Rt=NaN,this.At=NaN}originCoordX(){return this.Rt}originCoordY(){return this.At}setPosition(t,i,s){this.Ot||(this.Ot=!0),this.Pt=!0,this.zt(t,i,s)}appliedIndex(){return this.Tt}appliedX(){return this.Et}appliedY(){return this.Nt}visible(){return this.Pt}clearPosition(){this.Pt=!1,this.Wt(),this.Ct=NaN,this.Et=NaN,this.Nt=NaN,this.xt=null,this.clearOriginCoord()}paneViews(t){return null!==this.xt?[this.Ft,this.It]:[]}horzLineVisible(t){return t===this.xt&&this.Lt.horzLine.visible}vertLineVisible(){return this.Lt.vertLine.visible}priceAxisViews(t,i){this.Pt&&this.xt===t||this.Dt.clear();const s=[];return this.xt===t&&s.push(this.jt(this.Dt,i,this.Vt)),s}timeAxisViews(){return this.Pt?[this.Bt]:[]}pane(){return this.xt}updateAllViews(){this.Ft.rt(),this.Dt.forEach((t=>t.update())),this.Bt.rt(),this.It.update()}$t(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null}zt(t,i,s){this.Ht(t,i,s)&&this.updateAllViews()}Ht(t,i,s){const e=this.Et,n=this.Nt,h=this.Ct,r=this.Tt,l=this.xt,a=this.$t(s);this.Tt=t,this.Et=isNaN(t)?NaN:this.St.timeScale().indexToCoordinate(t),this.xt=s;const o=null!==a?a.firstValue():null;return null!==a&&null!==o?(this.Ct=i,this.Nt=a.priceToCoordinate(i,o)):(this.Ct=NaN,this.Nt=NaN),e!==this.Et||n!==this.Nt||r!==this.Tt||h!==this.Ct||l!==this.xt}Wt(){const t=this.St.serieses().map((t=>t.bars().lastIndex())).filter(k),i=0===t.length?null:Math.max(...t);this.Tt=null!==i?i:NaN}jt(t,i,s){let e=t.get(i);return void 0===e&&(e=new $(this,i,s),t.set(i,e)),e}}function Z(t){return"left"===t||"right"===t}class G{constructor(t){this.Ut=new Map,this.qt=[],this.Yt=t}invalidatePane(t,i){const s=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Ut.get(t),i);this.Ut.set(t,s)}fullInvalidation(){return this.Yt}invalidateForPane(t){const i=this.Ut.get(t);return void 0===i?{level:this.Yt}:{level:Math.max(this.Yt,i.level),autoScale:i.autoScale}}setFitContent(){this.qt=[{type:0}]}applyRange(t){this.qt=[{type:1,value:t}]}resetTimeScale(){this.qt=[{type:4}]}setBarSpacing(t){this.qt.push({type:2,value:t})}setRightOffset(t){this.qt.push({type:3,value:t})}timeScaleInvalidations(){return this.qt}merge(t){for(const i of t.qt)this.Xt(i);this.Yt=Math.max(this.Yt,t.Yt),t.Ut.forEach(((t,i)=>{this.invalidatePane(i,t)}))}Xt(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}}}const J=".";function Q(t,i){if(!g(t))return"n/a";if(!b(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class tt{constructor(t,i){if(i||(i=1),g(t)&&b(t)||(t=100),t<0)throw new TypeError("invalid base");this.wt=t,this.Kt=i,this.Zt()}format(t){const i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.Gt(t)}Zt(){if(this.Jt=0,this.wt>0&&this.Kt>0){let t=this.wt;for(;t>1;)t/=10,this.Jt++}}Gt(t){const i=this.wt/this.Kt;let s=Math.floor(t),e="";const n=void 0!==this.Jt?this.Jt:NaN;if(i>1){let h=+(Math.round(t*i)-s*i).toFixed(this.Jt);h>=i&&(h-=i,s+=1),e=J+Q(+h.toFixed(this.Jt)*this.Kt,n)}else s=Math.round(s*i)/i,n>0&&(e=J+Q(0,n));return s.toFixed(0)+e}}class it extends tt{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class st{constructor(t){this.Qt=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.ti(t):t<999995?i+this.ti(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.ti(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.ti(t/1e9)+"B")}ti(t){let i;const s=Math.pow(10,this.Qt);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.Qt).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function et(t,i,s,e){if(0===i.length)return;const n=i[e.from].K,h=i[e.from].Z;t.moveTo(n,h);for(let n=e.from+1;n<e.to;++n){const e=i[n];switch(s){case 0:t.lineTo(e.K,e.Z);break;case 1:t.lineTo(e.K,i[n-1].Z),t.lineTo(e.K,e.Z);break;case 2:{const[s,h]=rt(i,n-1,n);t.bezierCurveTo(s.K,s.Z,h.K,h.Z,e.K,e.Z);break}}}}function nt(t,i){return{K:t.K-i.K,Z:t.Z-i.Z}}function ht(t,i){return{K:t.K/i,Z:t.Z/i}}function rt(t,i,s){const e=Math.max(0,i-1),n=Math.min(t.length-1,s+1);var h,r;return[(h=t[i],r=ht(nt(t[s],t[e]),6),{K:h.K+r.K,Z:h.Z+r.Z}),nt(t[s],ht(nt(t[n],t[i]),6))]}class lt extends O{constructor(){super(...arguments),this.O=null}N(t){this.O=t}P(t){if(null!==this.O&&0!==this.O.A.length&&null!==this.O.R){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.O.tt,s(t,this.O.st),t.lineWidth=1,t.beginPath(),1===this.O.A.length){const i=this.O.A[0],s=this.O.ii/2;t.moveTo(i.x-s,this.O.si),t.lineTo(i.x-s,i.y),t.lineTo(i.x+s,i.y),t.lineTo(i.x+s,this.O.si)}else t.moveTo(this.O.A[this.O.R.from].x,this.O.si),t.lineTo(this.O.A[this.O.R.from].x,this.O.A[this.O.R.from].y),et(t,this.O.A,this.O.ei,this.O.R),this.O.R.to>this.O.R.from&&(t.lineTo(this.O.A[this.O.R.to-1].x,this.O.si),t.lineTo(this.O.A[this.O.R.from].x,this.O.si));t.closePath(),t.fillStyle=this.ni(t),t.fill()}}}class at extends lt{ni(t){const i=this.O,s=t.createLinearGradient(0,0,0,i.hi);return s.addColorStop(0,i.ri),s.addColorStop(1,i.li),s}}class ot extends O{constructor(){super(...arguments),this.O=null}N(t){this.O=t}P(t){if(null!==this.O&&0!==this.O.A.length&&null!==this.O.R)if(t.lineCap="butt",t.lineWidth=this.O.tt,s(t,this.O.st),t.strokeStyle=this.ai(t),t.lineJoin="round",1===this.O.A.length){t.beginPath();const i=this.O.A[0];t.moveTo(i.x-this.O.ii/2,i.y),t.lineTo(i.x+this.O.ii/2,i.y),void 0!==i.it&&(t.strokeStyle=i.it),t.stroke()}else this.oi(t,this.O)}oi(t,i){t.beginPath(),et(t,i.A,i.ei,i.R),t.stroke()}}class ut extends ot{oi(t,i){var s,e;const{A:n,R:h,ei:r,V:l}=i;if(0===n.length||null===h)return;t.beginPath();const a=n[h.from];t.moveTo(a.x,a.y);let o=null!==(s=a.it)&&void 0!==s?s:l;t.strokeStyle=o;const u=i=>{t.stroke(),t.beginPath(),t.strokeStyle=i,o=i};for(let i=h.from+1;i<h.to;++i){const s=n[i],h=null!==(e=s.it)&&void 0!==e?e:l;switch(r){case 0:t.lineTo(s.x,s.y);break;case 1:t.lineTo(s.x,n[i-1].y),h!==o&&(u(h),t.lineTo(s.x,n[i-1].y)),t.lineTo(s.x,s.y);break;case 2:{const[e,h]=rt(n,i-1,i);t.bezierCurveTo(e.K,e.Z,h.K,h.Z,s.x,s.y);break}}1!==r&&h!==o&&(u(h),t.moveTo(s.x,s.y))}t.stroke()}ai(){return this.O.V}}function ct(t,i,s,e=0,n=t.length){let h=n-e;for(;0<h;){const n=h>>1,r=e+n;s(t[r],i)?(e=r+1,h-=n+1):h=n}return e}function _t(t,i,s,e=0,n=t.length){let h=n-e;for(;0<h;){const n=h>>1,r=e+n;s(i,t[r])?h=n:(e=r+1,h-=n+1)}return e}function dt(t,i){return t.time<i}function ft(t,i){return t<i.time}function pt(t,i,s){const e=i.left(),n=i.right(),h=ct(t,e,dt),r=_t(t,n,ft);if(!s)return{from:h,to:r};let l=h,a=r;return h>0&&h<t.length&&t[h].time>=e&&(l=h-1),r>0&&r<t.length&&t[r-1].time<=n&&(a=r+1),{from:l,to:a}}class vt{constructor(t,i,s){this.ui=!0,this.ci=!0,this._i=!0,this.di=[],this.fi=null,this.pi=t,this.vi=i,this.mi=s}update(t){this.ui=!0,"data"===t&&(this.ci=!0),"options"===t&&(this._i=!0)}wi(){this.ci&&(this.gi(),this.ci=!1),this.ui&&(this.bi(),this.ui=!1),this._i&&(this.Mi(),this._i=!1)}Si(){this.fi=null}bi(){const t=this.pi.priceScale(),i=this.vi.timeScale();if(this.Si(),i.isEmpty()||t.isEmpty())return;const s=i.visibleStrictRange();if(null===s)return;if(0===this.pi.bars().size())return;const e=this.pi.firstValue();null!==e&&(this.fi=pt(this.di,s,this.mi),this.yi(t,i,e.value))}}class mt extends vt{constructor(t,i){super(t,i,!0)}yi(t,i,s){i.indexesToCoordinates(this.di,x(this.fi)),t.pointsArrayToCoordinates(this.di,s,x(this.fi))}ki(t,i){return{time:t,price:i,x:NaN,y:NaN}}Mi(){}gi(){const t=this.pi.barColorer();this.di=this.pi.bars().rows().map((i=>{const s=i.value[3];return this.xi(i.index,s,t)}))}}class wt extends mt{constructor(t,i){super(t,i),this.nt=new D,this.Ci=new at,this.Ti=new ut,this.nt.T([this.Ci,this.Ti])}renderer(t,i){if(!this.pi.visible())return null;const s=this.pi.options();return this.wi(),this.Ci.N({ei:s.lineType,A:this.di,st:s.lineStyle,tt:s.lineWidth,ri:s.topColor,li:s.bottomColor,si:t,hi:t,R:this.fi,ii:this.vi.timeScale().barSpacing()}),this.Ti.N({ei:s.lineType,A:this.di,V:s.lineColor,st:s.lineStyle,tt:s.lineWidth,R:this.fi,ii:this.vi.timeScale().barSpacing()}),this.nt}xi(t,i){return this.ki(t,i)}}class gt{constructor(){this.U=null,this.Pi=0,this.Di=0}N(t){this.U=t}draw(t,i,s,e){if(null===this.U||0===this.U.Oi.length||null===this.U.R)return;if(this.Pi=this.Ei(i),this.Pi>=2){Math.max(1,Math.floor(i))%2!=this.Pi%2&&this.Pi--}this.Di=this.U.Ni?Math.min(this.Pi,Math.floor(i)):this.Pi;let n=null;const h=this.Di<=this.Pi&&this.U.Ri>=Math.floor(1.5*i);for(let s=this.U.R.from;s<this.U.R.to;++s){const e=this.U.Oi[s];n!==e.it&&(t.fillStyle=e.it,n=e.it);const r=Math.floor(.5*this.Di),l=Math.round(e.x*i),a=l-r,o=this.Di,u=a+o-1,c=Math.min(e.highY,e.lowY),_=Math.max(e.highY,e.lowY),d=Math.round(c*i)-r,f=Math.round(_*i)+r,p=Math.max(f-d,this.Di);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.Pi);if(h){if(this.U.Ai){const s=l-v;let n=Math.max(d,Math.round(e.openY*i)-r),h=n+o-1;h>d+p-1&&(h=d+p-1,n=h-o+1),t.fillRect(s,n,a-s,h-n+1)}const s=l+v;let n=Math.max(d,Math.round(e.closeY*i)-r),h=n+o-1;h>d+p-1&&(h=d+p-1,n=h-o+1),t.fillRect(u+1,n,s-u,h-n+1)}}}Ei(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(r(this.U).Ri,t)))}}class bt extends vt{constructor(t,i){super(t,i,!1)}yi(t,i,s){i.indexesToCoordinates(this.di,x(this.fi)),t.barPricesToCoordinates(this.di,s,x(this.fi))}Li(t,i,s){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}}gi(){const t=this.pi.barColorer();this.di=this.pi.bars().rows().map((i=>this.xi(i.index,i,t)))}}class Mt extends bt{constructor(){super(...arguments),this.nt=new gt}renderer(t,i){if(!this.pi.visible())return null;const s=this.pi.options();this.wi();const e={Oi:this.di,Ri:this.vi.timeScale().barSpacing(),Ai:s.openVisible,Ni:s.thinBars,R:this.fi};return this.nt.N(e),this.nt}Mi(){this.di.forEach((t=>{t.it=this.pi.barColorer().barStyle(t.time).barColor}))}xi(t,i,s){return Object.assign(Object.assign({},this.Li(t,i,s)),{it:s.barStyle(t).barColor})}}function St(t,i,s){return Math.min(Math.max(t,i),s)}function yt(t,i,s){return i-t<=s}function kt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function xt(t){const i=Math.ceil(t);return i%2!=0?i-1:i}function Ct(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Tt extends lt{ni(t){const i=this.O,s=t.createLinearGradient(0,0,0,i.hi),e=St(i.si/i.hi,0,1);return s.addColorStop(0,i.Ii),s.addColorStop(e,i.Vi),s.addColorStop(e,i.Bi),s.addColorStop(1,i.Fi),s}}class Pt extends ot{ai(t){const i=this.O,s=t.createLinearGradient(0,0,0,i.hi),e=St(i.si/i.hi,0,1);return s.addColorStop(0,i.ri),s.addColorStop(e,i.ri),s.addColorStop(e,i.li),s.addColorStop(1,i.li),s}}class Dt extends mt{constructor(t,i){super(t,i),this.zi=new Tt,this.Wi=new Pt,this.B=new D,this.B.T([this.zi,this.Wi])}renderer(t,i){if(!this.pi.visible())return null;const s=this.pi.firstValue();if(null===s)return null;const e=this.pi.options();this.wi();const n=this.pi.priceScale().priceToCoordinate(e.baseValue.price,s.value),h=this.vi.timeScale().barSpacing();return this.zi.N({A:this.di,Ii:e.topFillColor1,Vi:e.topFillColor2,Bi:e.bottomFillColor1,Fi:e.bottomFillColor2,tt:e.lineWidth,st:e.lineStyle,ei:e.lineType,si:n,hi:t,R:this.fi,ii:h}),this.Wi.N({A:this.di,ri:e.topLineColor,li:e.bottomLineColor,tt:e.lineWidth,st:e.lineStyle,ei:e.lineType,si:n,hi:t,R:this.fi,ii:h}),this.B}xi(t,i){return this.ki(t,i)}}class Ot{constructor(){this.U=null,this.Pi=0}N(t){this.U=t}draw(t,i,s,e){if(null===this.U||0===this.U.Oi.length||null===this.U.R)return;if(this.Pi=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),e=Math.floor(t*s*i),n=Math.floor(t*i),h=Math.min(e,n);return Math.max(Math.floor(i),h)}(this.U.Ri,i),this.Pi>=2){Math.floor(i)%2!=this.Pi%2&&this.Pi--}const n=this.U.Oi;this.U.ji&&this.$i(t,n,this.U.R,i),this.U.Hi&&this.Ui(t,n,this.U.R,this.U.Ri,i);const h=this.qi(i);(!this.U.Hi||this.Pi>2*h)&&this.Yi(t,n,this.U.R,i)}$i(t,i,s,e){if(null===this.U)return;let n="",h=Math.min(Math.floor(e),Math.floor(this.U.Ri*e));h=Math.max(Math.floor(e),Math.min(h,this.Pi));const r=Math.floor(.5*h);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Xi!==n&&(t.fillStyle=s.Xi,n=s.Xi);const o=Math.round(Math.min(s.openY,s.closeY)*e),u=Math.round(Math.max(s.openY,s.closeY)*e),c=Math.round(s.highY*e),_=Math.round(s.lowY*e);let d=Math.round(e*s.x)-r;const f=d+h-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,c,p,o-c),t.fillRect(d,u+1,p,_-u),l=f}}qi(t){let i=Math.floor(1*t);this.Pi<=2*i&&(i=Math.floor(.5*(this.Pi-1)));const s=Math.max(Math.floor(t),i);return this.Pi<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Ui(t,i,s,e,n){if(null===this.U)return;let h="";const r=this.qi(n);let l=null;for(let e=s.from;e<s.to;e++){const s=i[e];s.Ki!==h&&(t.fillStyle=s.Ki,h=s.Ki);let a=Math.round(s.x*n)-Math.floor(.5*this.Pi);const o=a+this.Pi-1,u=Math.round(Math.min(s.openY,s.closeY)*n),c=Math.round(Math.max(s.openY,s.closeY)*n);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.U.Ri*n>2*r)V(t,a,u,o-a+1,c-u+1,r);else{const i=o-a+1;t.fillRect(a,u,i,c-u+1)}l=o}}Yi(t,i,s,e){if(null===this.U)return;let n="";const h=this.qi(e);for(let r=s.from;r<s.to;r++){const s=i[r];let l=Math.round(Math.min(s.openY,s.closeY)*e),a=Math.round(Math.max(s.openY,s.closeY)*e),o=Math.round(s.x*e)-Math.floor(.5*this.Pi),u=o+this.Pi-1;if(s.it!==n){const i=s.it;t.fillStyle=i,n=i}this.U.Hi&&(o+=h,l+=h,u-=h,a-=h),l>a||t.fillRect(o,l,u-o+1,a-l+1)}}}class Et extends bt{constructor(){super(...arguments),this.nt=new Ot}renderer(t,i){if(!this.pi.visible())return null;const s=this.pi.options();this.wi();const e={Oi:this.di,Ri:this.vi.timeScale().barSpacing(),ji:s.wickVisible,Hi:s.borderVisible,R:this.fi};return this.nt.N(e),this.nt}Mi(){this.di.forEach((t=>{const i=this.pi.barColorer().barStyle(t.time);t.it=i.barColor,t.Xi=i.barWickColor,t.Ki=i.barBorderColor}))}xi(t,i,s){const e=s.barStyle(t);return Object.assign(Object.assign({},this.Li(t,i,s)),{it:e.barColor,Xi:e.barWickColor,Ki:e.barBorderColor})}}class Nt{constructor(){this.U=null,this.Zi=[]}N(t){this.U=t,this.Zi=[]}draw(t,i,s,e){if(null===this.U||0===this.U.A.length||null===this.U.R)return;this.Zi.length||this.Gi(i);const n=Math.max(1,Math.floor(i)),h=Math.round(this.U.Ji*i)-Math.floor(n/2),r=h+n;for(let s=this.U.R.from;s<this.U.R.to;s++){const e=this.U.A[s],l=this.Zi[s-this.U.R.from],a=Math.round(e.y*i);let o,u;t.fillStyle=e.it,a<=h?(o=a,u=r):(o=h,u=a-Math.floor(n/2)+n),t.fillRect(l.Qi,o,l.ts-l.Qi+1,u-o)}}Gi(t){if(null===this.U||0===this.U.A.length||null===this.U.R)return void(this.Zi=[]);const i=Math.ceil(this.U.Ri*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.U.Ri*t)-i;this.Zi=new Array(this.U.R.to-this.U.R.from);for(let i=this.U.R.from;i<this.U.R.to;i++){const e=this.U.A[i],n=Math.round(e.x*t);let h,r;if(s%2){const t=(s-1)/2;h=n-t,r=n+t}else{const t=s/2;h=n-t,r=n+t-1}this.Zi[i-this.U.R.from]={Qi:h,ts:r,ss:n,es:e.x*t,yt:e.time}}for(let t=this.U.R.from+1;t<this.U.R.to;t++){const s=this.Zi[t-this.U.R.from],e=this.Zi[t-this.U.R.from-1];s.yt===e.yt+1&&(s.Qi-e.ts!==i+1&&(e.ss>e.es?e.ts=s.Qi-i-1:s.Qi=e.ts+i+1))}let e=Math.ceil(this.U.Ri*t);for(let t=this.U.R.from;t<this.U.R.to;t++){const i=this.Zi[t-this.U.R.from];i.ts<i.Qi&&(i.ts=i.Qi);const s=i.ts-i.Qi+1;e=Math.min(s,e)}if(i>0&&e<4)for(let t=this.U.R.from;t<this.U.R.to;t++){const i=this.Zi[t-this.U.R.from];i.ts-i.Qi+1>e&&(i.ss>i.es?i.ts-=1:i.Qi+=1)}}}function Rt(t){return{A:[],Ri:t,Ji:NaN,R:null}}function At(t,i,s){return{time:t,price:i,x:NaN,y:NaN,it:s}}class Lt extends vt{constructor(t,i){super(t,i,!1),this.B=new D,this.ns=Rt(0),this.nt=new Nt}renderer(t,i){return this.pi.visible()?(this.wi(),this.B):null}gi(){const t=this.vi.timeScale().barSpacing();this.ns=Rt(t);let i=0,s=0;const e=this.pi.options().color;for(const t of this.pi.bars().rows()){const n=t.value[3],h=void 0!==t.color?t.color:e,r=At(t.index,n,h);i++,i<this.ns.A.length?this.ns.A[i]=r:this.ns.A.push(r),this.di[s++]={time:t.index,x:0}}this.nt.N(this.ns),this.B.T([this.nt])}Mi(){}Si(){super.Si(),this.ns.R=null}yi(t,i,s){if(null===this.fi)return;const e=i.barSpacing(),n=r(i.visibleStrictRange()),h=t.priceToCoordinate(this.pi.options().base,s);i.indexesToCoordinates(this.ns.A),t.pointsArrayToCoordinates(this.ns.A,s),this.ns.Ji=h,this.ns.R=pt(this.ns.A,n,!1),this.ns.Ri=e,this.nt.N(this.ns)}}class It extends mt{constructor(t,i){super(t,i),this.Ti=new ut}renderer(t,i){if(!this.pi.visible())return null;const s=this.pi.options();this.wi();const e={A:this.di,V:s.color,st:s.lineStyle,ei:s.lineType,tt:s.lineWidth,R:this.fi,ii:this.vi.timeScale().barSpacing()};return this.Ti.N(e),this.Ti}Mi(){this.di.forEach((t=>{t.it=this.pi.barColorer().barStyle(t.time).barColor}))}xi(t,i,s){const e=this.ki(t,i);return e.it=s.barStyle(t).barColor,e}}const Vt=/[2-9]/g;class Bt{constructor(t=50){this.hs=new Map,this.rs=0,this.ls=Array.from(new Array(t))}reset(){this.hs.clear(),this.ls.fill(void 0)}measureText(t,i,s){const e=s||Vt,n=String(i).replace(e,"0");let h=this.hs.get(n);if(void 0===h){if(h=t.measureText(n).width,0===h&&0!==i.length)return 0;const s=this.ls[this.rs];void 0!==s&&this.hs.delete(s),this.ls[this.rs]=n,this.rs=(this.rs+1)%this.ls.length,this.hs.set(n,h)}return h}}class Ft{constructor(t){this.os=null,this.m=null,this.us="right",this.cs=0,this._s=t}ds(t,i,s,e){this.os=t,this.m=i,this.cs=s,this.us=e}draw(t,i){null!==this.m&&null!==this.os&&this.os.draw(t,this.m,this._s,this.cs,this.us,i)}}class zt{constructor(t,i,s){this.fs=t,this._s=new Bt(50),this.ps=i,this.g=s,this.M=-1,this.nt=new Ft(this._s)}renderer(t,i){const s=this.g.paneForSource(this.ps);if(null===s)return null;const e=s.isOverlay(this.ps)?s.defaultVisiblePriceScale():this.ps.priceScale();if(null===e)return null;const n=s.priceScalePosition(e);if("overlay"===n)return null;const h=this.g.priceAxisRendererOptions();return h.fontSize!==this.M&&(this.M=h.fontSize,this._s.reset()),this.nt.ds(this.fs.paneRenderer(),h,i,n),this.nt}}class Wt extends O{constructor(){super(...arguments),this._s=new Bt,this.M=-1,this.S="",this.vs=""}ds(t,i){this.M===t&&this.S===i||(this.M=t,this.S=i,this.vs=T(t,i),this._s.reset())}hitTest(t,i){return null}P(t,i,s){t.textBaseline="middle",t.font=this.vs,this.ws&&this.ws(t)}}class jt{constructor(t,i){this.nt=new Wt,this.gs=t,this.St=i}update(t){}renderer(t,i,s){if(!this.gs.visible())return null;const e=this.St.options().layout;return this.nt.ds(e.fontSize,e.fontFamily),this.nt}bs(t){t.init(this.gs,this.St),this.nt.ws=i=>t.render(i)}}class $t{constructor(){this.U=null}N(t){this.U=t}draw(t,i,n,h){if(null===this.U)return;if(!1===this.U.q)return;const r=Math.round(this.U.Z*i);if(r<0||r>Math.ceil(this.U.Ms*i))return;const l=Math.ceil(this.U.Ss*i);t.lineCap="butt",t.strokeStyle=this.U.it,t.lineWidth=Math.floor(this.U.tt*i),s(t,this.U.st),e(t,r,0,l)}}class Ht{constructor(t){this.ys={Ss:0,Ms:0,Z:0,it:"rgba(0, 0, 0, 0)",tt:1,st:0,q:!1},this.ks=new $t,this.j=!0,this.pi=t,this.vi=t.model(),this.ks.N(this.ys)}rt(){this.j=!0}renderer(t,i){return this.pi.visible()?(this.j&&(this.xs(t,i),this.j=!1),this.ks):null}}class Ut extends Ht{constructor(t){super(t)}xs(t,i){this.ys.q=!1;const s=this.pi.priceScale(),e=s.mode().mode;if(2!==e&&3!==e)return;const n=this.pi.options();if(!n.baseLineVisible||!this.pi.visible())return;const h=this.pi.firstValue();null!==h&&(this.ys.q=!0,this.ys.Z=s.priceToCoordinate(h.value,h.value),this.ys.Ss=i,this.ys.Ms=t,this.ys.it=n.baseLineColor,this.ys.tt=n.baseLineWidth,this.ys.st=n.baseLineStyle)}}class qt{constructor(){this.U=null}N(t){this.U=t}Cs(){return this.U}draw(t,i,s,e){const n=this.U;if(null===n)return;t.save();const h=Math.max(1,Math.floor(i)),r=h%2/2,l=Math.round(n.es.x*i)+r,a=n.es.y*i;t.fillStyle=n.Ts,t.beginPath();const o=Math.max(2,1.5*n.Ps)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=n.Ds,t.beginPath(),t.arc(l,a,n.I*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=h,t.strokeStyle=n.Os,t.beginPath(),t.arc(l,a,n.I*i+h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Yt=[{Es:0,Ns:.25,Rs:4,As:10,Ls:.25,Is:0,Vs:.4,Bs:.8},{Es:.25,Ns:.525,Rs:10,As:14,Ls:0,Is:0,Vs:.8,Bs:0},{Es:.525,Ns:1,Rs:14,As:14,Ls:0,Is:0,Vs:0,Bs:0}];function Xt(t,i,s,e){return function(t,i){if("transparent"===t)return t;const s=p(t),e=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*e})`}(t,s+(e-s)*i)}function Kt(t,i){const s=t%2600/2600;let e;for(const t of Yt)if(s>=t.Es&&s<=t.Ns){e=t;break}n(void 0!==e,"Last price animation internal logic error");const h=(s-e.Es)/(e.Ns-e.Es);return{Ds:Xt(i,h,e.Ls,e.Is),Os:Xt(i,h,e.Vs,e.Bs),I:(r=h,l=e.Rs,a=e.As,l+(a-l)*r)};var r,l,a}class Zt{constructor(t){this.nt=new qt,this.j=!0,this.Fs=!0,this.zs=performance.now(),this.Ws=this.zs-1,this.gs=t}js(){this.Ws=this.zs-1,this.update()}$s(){if(this.update(),2===this.gs.options().lastPriceAnimation){const t=performance.now(),i=this.Ws-t;if(i>0)return void(i<650&&(this.Ws+=2600));this.zs=t,this.Ws=t+2600}}update(){this.j=!0}Hs(){this.Fs=!0}q(){return 0!==this.gs.options().lastPriceAnimation}Us(){switch(this.gs.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Ws}}renderer(t,i){return this.j?(this.H(t,i),this.j=!1,this.Fs=!1):this.Fs&&(this.qs(),this.Fs=!1),this.nt}H(t,i){this.nt.N(null);const s=this.gs.model().timeScale(),e=s.visibleStrictRange(),n=this.gs.firstValue();if(null===e||null===n)return;const h=this.gs.lastValueData(!0);if(h.noData||!e.contains(h.index))return;const r={x:s.indexToCoordinate(h.index),y:this.gs.priceScale().priceToCoordinate(h.price,n.value)},l=h.color,a=this.gs.options().lineWidth,o=Kt(this.Ys(),l);this.nt.N({Ts:l,Ps:a,Ds:o.Ds,Os:o.Os,I:o.I,es:r})}qs(){const t=this.nt.Cs();if(null!==t){const i=Kt(this.Ys(),t.Ts);t.Ds=i.Ds,t.Os=i.Os,t.I=i.I}}Ys(){return this.Us()?performance.now()-this.zs:2599}}function Gt(t,i){return Ct(Math.min(Math.max(t,12),30)*i)}function Jt(t,i){switch(t){case"arrowDown":case"arrowUp":return Gt(i,1);case"circle":return Gt(i,.8);case"square":return Gt(i,.7)}}function Qt(t){return xt(Gt(t,1))}function ti(t){return Math.max(Gt(t,.1),3)}function ii(t,i,s,e,n){const h=Jt("square",s),r=(h-1)/2,l=t-r,a=i-r;return e>=l&&e<=l+h&&n>=a&&n<=a+h}function si(t,i,s,e,n){const h=(Jt("arrowUp",n)-1)/2,r=(Ct(n/2)-1)/2;i.beginPath(),t?(i.moveTo(s-h,e),i.lineTo(s,e-h),i.lineTo(s+h,e),i.lineTo(s+r,e),i.lineTo(s+r,e+h),i.lineTo(s-r,e+h),i.lineTo(s-r,e)):(i.moveTo(s-h,e),i.lineTo(s,e+h),i.lineTo(s+h,e),i.lineTo(s+r,e),i.lineTo(s+r,e-h),i.lineTo(s-r,e-h),i.lineTo(s-r,e)),i.fill()}function ei(t,i,s,e,n,h){return ii(i,s,e,n,h)}class ni extends O{constructor(){super(...arguments),this.U=null,this._s=new Bt,this.M=-1,this.S="",this.vs=""}N(t){this.U=t}ds(t,i){this.M===t&&this.S===i||(this.M=t,this.S=i,this.vs=T(t,i),this._s.reset())}hitTest(t,i){if(null===this.U||null===this.U.R)return null;for(let s=this.U.R.from;s<this.U.R.to;s++){const e=this.U.A[s];if(ri(e,t,i))return{hitTestData:e.Xs,externalId:e.Ks}}return null}P(t,i,s){if(null!==this.U&&null!==this.U.R){t.textBaseline="middle",t.font=this.vs;for(let i=this.U.R.from;i<this.U.R.to;i++){const s=this.U.A[i];void 0!==s.Zs&&(s.Zs.Ss=this._s.measureText(t,s.Zs.Gs),s.Zs.Ms=this.M),hi(s,t)}}}}function hi(t,i){i.fillStyle=t.it,void 0!==t.Zs&&function(t,i,s,e){t.fillText(i,s,e)}(i,t.Zs.Gs,t.x-t.Zs.Ss/2,t.Zs.Z),function(t,i){if(0===t.Js)return;switch(t.Qs){case"arrowDown":return void si(!1,i,t.x,t.Z,t.Js);case"arrowUp":return void si(!0,i,t.x,t.Z,t.Js);case"circle":return void function(t,i,s,e){const n=(Jt("circle",e)-1)/2;t.beginPath(),t.arc(i,s,n,0,2*Math.PI,!1),t.fill()}(i,t.x,t.Z,t.Js);case"square":return void function(t,i,s,e){const n=Jt("square",e),h=(n-1)/2,r=i-h,l=s-h;t.fillRect(r,l,n,n)}(i,t.x,t.Z,t.Js)}t.Qs}(t,i)}function ri(t,i,s){return!(void 0===t.Zs||!function(t,i,s,e,n,h){const r=e/2;return n>=t&&n<=t+s&&h>=i-r&&h<=i+r}(t.x,t.Zs.Z,t.Zs.Ss,t.Zs.Ms,i,s))||function(t,i,s){if(0===t.Js)return!1;switch(t.Qs){case"arrowDown":case"arrowUp":return ei(0,t.x,t.Z,t.Js,i,s);case"circle":return function(t,i,s,e,n){const h=2+Jt("circle",s)/2,r=t-e,l=i-n;return Math.sqrt(r*r+l*l)<=h}(t.x,t.Z,t.Js,i,s);case"square":return ii(t.x,t.Z,t.Js,i,s)}}(t,i,s)}function li(t,i,s,e,n,h,r,l,a){const o=g(s)?s:s.close,u=g(s)?s:s.high,c=g(s)?s:s.low,_=g(i.size)?Math.max(i.size,0):1,d=Qt(l.barSpacing())*_,f=d/2;switch(t.Js=d,i.position){case"inBar":return t.Z=r.priceToCoordinate(o,a),void(void 0!==t.Zs&&(t.Zs.Z=t.Z+f+h+.6*n));case"aboveBar":return t.Z=r.priceToCoordinate(u,a)-f-e.te,void 0!==t.Zs&&(t.Zs.Z=t.Z-f-.6*n,e.te+=1.2*n),void(e.te+=d+h);case"belowBar":return t.Z=r.priceToCoordinate(c,a)+f+e.ie,void 0!==t.Zs&&(t.Zs.Z=t.Z+f+h+.6*n,e.ie+=1.2*n),void(e.ie+=d+h)}i.position}class ai{constructor(t,i){this.j=!0,this.se=!0,this.ee=!0,this.ne=null,this.nt=new ni,this.gs=t,this.St=i,this.U={A:[],R:null}}update(t){this.j=!0,this.ee=!0,"data"===t&&(this.se=!0)}renderer(t,i,s){if(!this.gs.visible())return null;this.j&&this.wi();const e=this.St.options().layout;return this.nt.ds(e.fontSize,e.fontFamily),this.nt.N(this.U),this.nt}he(){if(this.ee){if(this.gs.indexedMarkers().length>0){const t=this.St.timeScale().barSpacing(),i=ti(t),s=1.5*Qt(t)+2*i;this.ne={above:s,below:s}}else this.ne=null;this.ee=!1}return this.ne}wi(){const t=this.gs.priceScale(),i=this.St.timeScale(),s=this.gs.indexedMarkers();this.se&&(this.U.A=s.map((t=>({time:t.time,x:0,Z:0,Js:0,Qs:t.shape,it:t.color,Xs:t.internalId,Ks:t.id,Zs:void 0}))),this.se=!1);const e=this.St.options().layout;this.U.R=null;const n=i.visibleStrictRange();if(null===n)return;const h=this.gs.firstValue();if(null===h)return;if(0===this.U.A.length)return;let r=NaN;const l=ti(i.barSpacing()),a={te:l,ie:l};this.U.R=pt(this.U.A,n,!0);for(let n=this.U.R.from;n<this.U.R.to;n++){const o=s[n];o.time!==r&&(a.te=l,a.ie=l,r=o.time);const u=this.U.A[n];u.x=i.indexToCoordinate(o.time),void 0!==o.text&&o.text.length>0&&(u.Zs={Gs:o.text,Z:0,Ss:0,Ms:0});const c=this.gs.dataAt(o.time);null!==c&&li(u,o,c,a,e.fontSize,l,t,i,h.value)}this.j=!1}}class oi extends Ht{constructor(t){super(t)}xs(t,i){const s=this.ys;s.q=!1;const e=this.pi.options();if(!e.priceLineVisible||!this.pi.visible())return;const n=this.pi.lastValueData(0===e.priceLineSource);n.noData||(s.q=!0,s.Z=n.coordinate,s.it=this.pi.priceLineColor(n.color),s.Ss=i,s.Ms=t,s.tt=e.priceLineWidth,s.st=e.priceLineStyle)}}class ui extends j{constructor(t){super(),this.ht=t}vt(t,i,s){t.visible=!1,i.visible=!1;const e=this.ht;if(!e.visible())return;const n=e.options(),h=n.lastValueVisible,r=""!==e.title(),l=0===n.seriesLastValueMode,a=e.lastValueData(!1);if(a.noData)return;h&&(t.text=this.re(a,h,l),t.visible=0!==t.text.length),(r||l)&&(i.text=this.le(a,h,r,l),i.visible=i.text.length>0);const o=e.priceLineColor(a.color),u=v(o);s.background=u.t,s.color=u.i,s.coordinate=a.coordinate,i.borderColor=e.model().backgroundColorAtYPercentFromTop(a.coordinate/e.priceScale().height()),t.borderColor=o}le(t,i,s,e){let n="";const h=this.ht.title();return s&&0!==h.length&&(n+=`${h} `),i&&e&&(n+=this.ht.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),n.trim()}re(t,i,s){return i?s?this.ht.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""}}class ci{constructor(t,i){this.ae=t,this.oe=i}equals(t){return null!==t&&(this.ae===t.ae&&this.oe===t.oe)}clone(){return new ci(this.ae,this.oe)}minValue(){return this.ae}maxValue(){return this.oe}length(){return this.oe-this.ae}isEmpty(){return this.oe===this.ae||Number.isNaN(this.oe)||Number.isNaN(this.ae)}merge(t){return null===t?this:new ci(Math.min(this.minValue(),t.minValue()),Math.max(this.maxValue(),t.maxValue()))}scaleAroundCenter(t){if(!g(t))return;if(0===this.oe-this.ae)return;const i=.5*(this.oe+this.ae);let s=this.oe-i,e=this.ae-i;s*=t,e*=t,this.oe=i+s,this.ae=i+e}shift(t){g(t)&&(this.oe+=t,this.ae+=t)}toRaw(){return{minValue:this.ae,maxValue:this.oe}}static fromRaw(t){return null===t?null:new ci(t.minValue,t.maxValue)}}class _i{constructor(t,i){this.ue=t,this.ce=i||null}priceRange(){return this.ue}margins(){return this.ce}toRaw(){return null===this.ue?null:{priceRange:this.ue.toRaw(),margins:this.ce||void 0}}static fromRaw(t){return null===t?null:new _i(ci.fromRaw(t.priceRange),t.margins)}}class di extends Ht{constructor(t,i){super(t),this._e=i}xs(t,i){const s=this.ys;s.q=!1;const e=this._e.options();if(!this.pi.visible()||!e.lineVisible)return;const n=this._e.yCoord();null!==n&&(s.q=!0,s.Z=n,s.it=e.color,s.Ss=i,s.Ms=t,s.tt=e.lineWidth,s.st=e.lineStyle)}}class fi extends j{constructor(t,i){super(),this.gs=t,this._e=i}vt(t,i,s){t.visible=!1,i.visible=!1;const e=this._e.options(),n=e.axisLabelVisible,h=""!==e.title,r=this.gs;if(!n||!r.visible())return;const l=this._e.yCoord();if(null===l)return;h&&(i.text=e.title,i.visible=!0),i.borderColor=r.model().backgroundColorAtYPercentFromTop(l/r.priceScale().height()),t.text=this.de(e.price),t.visible=!0;const a=v(e.color);s.background=a.t,s.color=a.i,s.coordinate=l}de(t){const i=this.gs.firstValue();return null===i?"":this.gs.priceScale().formatPrice(t,i.value)}}class pi{constructor(t,i){this.gs=t,this.Lt=i,this.fe=new di(t,this),this.fs=new fi(t,this),this.pe=new zt(this.fs,t,t.model())}applyOptions(t){w(this.Lt,t),this.update(),this.gs.model().lightUpdate()}options(){return this.Lt}paneView(){return this.fe}labelPaneView(){return this.pe}priceAxisView(){return this.fs}update(){this.fe.rt(),this.fs.update()}yCoord(){const t=this.gs,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;const s=t.firstValue();return null===s?null:i.priceToCoordinate(this.Lt.price,s.value)}}class vi extends Y{constructor(t){super(),this.St=t}model(){return this.St}}const mi={barColor:"",barBorderColor:"",barWickColor:""};class wi{constructor(t){this.gs=t}barStyle(t,i){const s=this.gs.seriesType(),e=this.gs.options();switch(s){case"Line":return this.ve(e,t,i);case"Area":return this.me(e);case"Baseline":return this.we(e,t,i);case"Bar":return this.ge(e,t,i);case"Candlestick":return this.be(e,t,i);case"Histogram":return this.Me(e,t,i)}throw new Error("Unknown chart style")}ge(t,i,s){const e=Object.assign({},mi),n=t.upColor,h=t.downColor,a=n,o=h,u=r(this.Se(i,s)),c=l(u.value[0])<=l(u.value[3]);return void 0!==u.color?(e.barColor=u.color,e.barBorderColor=u.color):(e.barColor=c?n:h,e.barBorderColor=c?a:o),e}be(t,i,s){var e,n,h;const a=Object.assign({},mi),o=t.upColor,u=t.downColor,c=t.borderUpColor,_=t.borderDownColor,d=t.wickUpColor,f=t.wickDownColor,p=r(this.Se(i,s)),v=l(p.value[0])<=l(p.value[3]);return a.barColor=null!==(e=p.color)&&void 0!==e?e:v?o:u,a.barBorderColor=null!==(n=p.borderColor)&&void 0!==n?n:v?c:_,a.barWickColor=null!==(h=p.wickColor)&&void 0!==h?h:v?d:f,a}me(t){return Object.assign(Object.assign({},mi),{barColor:t.lineColor})}we(t,i,s){const e=r(this.Se(i,s)).value[3]>=t.baseValue.price;return Object.assign(Object.assign({},mi),{barColor:e?t.topLineColor:t.bottomLineColor})}ve(t,i,s){var e;const n=r(this.Se(i,s));return Object.assign(Object.assign({},mi),{barColor:null!==(e=n.color)&&void 0!==e?e:t.color})}Me(t,i,s){const e=Object.assign({},mi),n=r(this.Se(i,s));return e.barColor=void 0!==n.color?n.color:t.color,e}Se(t,i){return void 0!==i?i.value:this.gs.bars().valueAt(t)}}var gi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(gi||(gi={}));const bi=30;class Mi{constructor(){this.ye=[],this.ke=new Map,this.xe=new Map}last(){return this.size()>0?this.ye[this.ye.length-1]:null}firstIndex(){return this.size()>0?this.Ce(0):null}lastIndex(){return this.size()>0?this.Ce(this.ye.length-1):null}size(){return this.ye.length}isEmpty(){return 0===this.size()}contains(t){return null!==this.Te(t,0)}valueAt(t){return this.search(t)}search(t,i=0){const s=this.Te(t,i);return null===s?null:Object.assign(Object.assign({},this.Pe(s)),{index:this.Ce(s)})}rows(){return this.ye}minMaxOnRangeCached(t,i,s){if(this.isEmpty())return null;let e=null;for(const n of s){e=Si(e,this.De(t,i,n))}return e}setData(t){this.xe.clear(),this.ke.clear(),this.ye=t}Ce(t){return this.ye[t].index}Pe(t){return this.ye[t]}Te(t,i){const s=this.Oe(t);if(null===s&&0!==i)switch(i){case-1:return this.Ee(t);case 1:return this.Ne(t);default:throw new TypeError("Unknown search mode")}return s}Ee(t){let i=this.Re(t);return i>0&&(i-=1),i!==this.ye.length&&this.Ce(i)<t?i:null}Ne(t){const i=this.Ae(t);return i!==this.ye.length&&t<this.Ce(i)?i:null}Oe(t){const i=this.Re(t);return i===this.ye.length||t<this.ye[i].index?null:i}Re(t){return ct(this.ye,t,((t,i)=>t.index<i))}Ae(t){return _t(this.ye,t,((t,i)=>i.index>t))}Le(t,i,s){let e=null;for(let n=t;n<i;n++){const t=this.ye[n].value[s];Number.isNaN(t)||(null===e?e={min:t,max:t}:(t<e.min&&(e.min=t),t>e.max&&(e.max=t)))}return e}De(t,i,s){if(this.isEmpty())return null;let e=null;const n=r(this.firstIndex()),h=r(this.lastIndex()),l=Math.max(t,n),a=Math.min(i,h),o=Math.ceil(l/bi)*bi,u=Math.max(o,Math.floor(a/bi)*bi);{const t=this.Re(l),n=this.Ae(Math.min(a,o,i));e=Si(e,this.Le(t,n,s))}let c=this.ke.get(s);void 0===c&&(c=new Map,this.ke.set(s,c));for(let t=Math.max(o+1,l);t<u;t+=bi){const i=Math.floor(t/bi);let n=c.get(i);if(void 0===n){const t=this.Re(i*bi),e=this.Ae((i+1)*bi-1);n=this.Le(t,e,s),c.set(i,n)}e=Si(e,n)}{const t=this.Re(u),i=this.Ae(a);e=Si(e,this.Le(t,i,s))}return e}}function Si(t,i){if(null===t)return i;if(null===i)return t;return{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}class yi extends vi{constructor(t,i,s){super(t),this.U=new Mi,this.fe=new oi(this),this.Ie=[],this.Ve=new Ut(this),this.Be=null,this.Fe=null,this.ze=[],this.We=[],this.je=null,this.Lt=i,this.$e=s;const e=new ui(this);this.Dt=[e],this.pe=new zt(e,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Be=new Zt(this)),this.He(),this.Ue()}setDrawingPane(t){this.qe.bs(t)}destroy(){null!==this.je&&clearTimeout(this.je)}priceLineColor(t){return this.Lt.priceLineColor||t}lastValueData(t){const i={noData:!0},s=this.priceScale();if(this.model().timeScale().isEmpty()||s.isEmpty()||this.U.isEmpty())return i;const e=this.model().timeScale().visibleStrictRange(),n=this.firstValue();if(null===e||null===n)return i;let h,r;if(t){const t=this.U.last();if(null===t)return i;h=t,r=t.index}else{const t=this.U.search(e.right(),-1);if(null===t)return i;if(h=this.U.valueAt(t.index),null===h)return i;r=t.index}const l=h.value[3],a=this.barColorer().barStyle(r,{value:h}),o=s.priceToCoordinate(l,n.value);return{noData:!1,price:l,text:s.formatPrice(l,n.value),formattedPriceAbsolute:s.formatPriceAbsolute(l),formattedPricePercentage:s.formatPricePercentage(l,n.value),color:a.barColor,coordinate:o,index:r}}barColorer(){return null!==this.Fe||(this.Fe=new wi(this)),this.Fe}options(){return this.Lt}applyOptions(t){const i=t.priceScaleId;void 0!==i&&i!==this.Lt.priceScaleId&&this.model().moveSeriesToScale(this,i),w(this.Lt,t),void 0!==t.priceFormat&&(this.He(),this.model().fullUpdate()),this.model().updateSource(this),this.model().updateCrosshair(),this.Ft.update("options")}setData(t,i){this.U.setData(t),this.Ye(),this.Ft.update("data"),this.It.update("data"),null!==this.Be&&(i&&i.lastBarUpdatedOrNewBarsAddedToTheRight?this.Be.$s():0===t.length&&this.Be.js());const s=this.model().paneForSource(this);this.model().recalculatePane(s),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()}setMarkers(t){this.ze=t,this.Ye();const i=this.model().paneForSource(this);this.It.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()}markers(){return this.ze}indexedMarkers(){return this.We}createPriceLine(t){const i=new pi(this,t);return this.Ie.push(i),this.model().updateSource(this),i}removePriceLine(t){const i=this.Ie.indexOf(t);-1!==i&&this.Ie.splice(i,1),this.model().updateSource(this)}seriesType(){return this.$e}firstValue(){const t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}}firstBar(){const t=this.model().timeScale().visibleStrictRange();if(null===t)return null;const i=t.left();return this.U.search(i,1)}bars(){return this.U}dataAt(t){const i=this.U.valueAt(t);return null===i?null:"Bar"===this.$e||"Candlestick"===this.$e?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]}topPaneViews(t){const i=this.Be;return null!==i&&i.q()?(null===this.je&&i.Us()&&(this.je=setTimeout((()=>{this.je=null,this.model().cursorUpdate()}),0)),i.Hs(),[i]):[]}paneViews(){const t=[];this.Xe()||t.push(this.Ve),t.push(this.Ft,this.fe,this.It,this.qe);const i=this.Ie.map((t=>t.paneView()));return t.push(...i),t}labelPaneViews(t){return[this.pe,...this.Ie.map((t=>t.labelPaneView()))]}priceAxisViews(t,i){if(i!==this._priceScale&&!this.Xe())return[];const s=[...this.Dt];for(const t of this.Ie)s.push(t.priceAxisView());return s}autoscaleInfo(t,i){if(void 0!==this.Lt.autoscaleInfoProvider){const s=this.Lt.autoscaleInfoProvider((()=>{const s=this.Ke(t,i);return null===s?null:s.toRaw()}));return _i.fromRaw(s)}return this.Ke(t,i)}minMove(){return this.Lt.priceFormat.minMove}formatter(){return this.Ze}updateAllViews(){var t;this.Ft.update(),this.It.update(),this.qe.update();for(const t of this.Dt)t.update();for(const t of this.Ie)t.update();this.fe.rt(),this.Ve.rt(),null===(t=this.Be)||void 0===t||t.update()}priceScale(){return r(super.priceScale())}markerDataAtIndex(t){if(!(("Line"===this.$e||"Area"===this.$e||"Baseline"===this.$e)&&this.Lt.crosshairMarkerVisible))return null;const i=this.U.valueAt(t);if(null===i)return null;return{price:i.value[3],radius:this.Ge(),borderColor:this.Je(),backgroundColor:this.Qe(t)}}title(){return this.Lt.title}visible(){return this.Lt.visible}Xe(){return!Z(this.priceScale().id())}Ke(t,i){if(!b(t)||!b(i)||this.U.isEmpty())return null;const s="Line"===this.$e||"Area"===this.$e||"Baseline"===this.$e||"Histogram"===this.$e?[3]:[2,1],e=this.U.minMaxOnRangeCached(t,i,s);let n=null!==e?new ci(e.min,e.max):null;if("Histogram"===this.seriesType()){const t=this.Lt.base,i=new ci(t,t);n=null!==n?n.merge(i):i}return new _i(n,this.It.he())}Ge(){switch(this.$e){case"Line":case"Area":case"Baseline":return this.Lt.crosshairMarkerRadius}return 0}Je(){switch(this.$e){case"Line":case"Area":case"Baseline":{const t=this.Lt.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Qe(t){switch(this.$e){case"Line":case"Area":case"Baseline":{const t=this.Lt.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.barColorer().barStyle(t).barColor}He(){switch(this.Lt.priceFormat.type){case"custom":this.Ze={format:this.Lt.priceFormat.formatter};break;case"volume":this.Ze=new st(this.Lt.priceFormat.precision);break;case"percent":this.Ze=new it(this.Lt.priceFormat.precision);break;default:{const t=Math.pow(10,this.Lt.priceFormat.precision);this.Ze=new tt(t,this.Lt.priceFormat.minMove*t)}}null!==this._priceScale&&this._priceScale.updateFormatter()}Ye(){const t=this.model().timeScale();if(t.isEmpty()||0===this.U.size())return void(this.We=[]);const i=r(this.U.firstIndex());this.We=this.ze.map(((s,e)=>{const n=r(t.timeToIndex(s.time,!0)),h=n<i?1:-1;return{time:r(this.U.search(n,h)).index,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:e,text:s.text,size:s.size}}))}Ue(){switch(this.It=new ai(this,this.model()),this.qe=new jt(this,this.model()),this.$e){case"Bar":this.Ft=new Mt(this,this.model());break;case"Candlestick":this.Ft=new Et(this,this.model());break;case"Line":this.Ft=new It(this,this.model());break;case"Area":this.Ft=new wt(this,this.model());break;case"Baseline":this.Ft=new Dt(this,this.model());break;case"Histogram":this.Ft=new Lt(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.$e)}}}class ki{constructor(t){this.Lt=t}tn(t,i,s){let e=t;if(0===this.Lt.mode)return e;const n=s.defaultPriceScale(),h=n.firstValue();if(null===h)return e;const r=n.priceToCoordinate(t,h),a=s.dataSources().filter((t=>t instanceof yi)).reduce(((t,e)=>{if(s.isOverlay(e)||!e.visible())return t;const n=e.priceScale(),h=e.bars();if(n.isEmpty()||!h.contains(i))return t;const r=h.valueAt(i);if(null===r)return t;const a=l(e.firstValue());return t.concat([n.priceToCoordinate(r.value[3],a.value)])}),[]);if(0===a.length)return e;a.sort(((t,i)=>Math.abs(t-r)-Math.abs(i-r)));const o=a[0];return e=n.coordinateToPrice(o,h),e}}class xi{constructor(){this.U=null}N(t){this.U=t}draw(t,i,e,n){if(null===this.U)return;const h=Math.max(1,Math.floor(i));t.lineWidth=h;const l=Math.ceil(this.U.J*i),a=Math.ceil(this.U.G*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const e=r(this.U);if(e.sn){t.strokeStyle=e.en,s(t,e.nn),t.beginPath();for(const s of e.hn){const e=Math.round(s.rn*i);t.moveTo(e,-h),t.lineTo(e,l+h)}t.stroke()}if(e.ln){t.strokeStyle=e.an,s(t,e.on),t.beginPath();for(const s of e.un){const e=Math.round(s.coord*i);t.moveTo(-h,e),t.lineTo(a+h,e)}t.stroke()}}))}}class Ci{constructor(t){this.nt=new xi,this.j=!0,this.xt=t}update(){this.j=!0}renderer(t,i){if(this.j){const s=this.xt.model().options().grid,e={J:t,G:i,ln:s.horzLines.visible,sn:s.vertLines.visible,an:s.horzLines.color,en:s.vertLines.color,on:s.horzLines.style,nn:s.vertLines.style,un:this.xt.defaultPriceScale().marks(),hn:this.xt.model().timeScale().marks()||[]};this.nt.N(e),this.j=!1}return this.nt}}class Ti{constructor(t){this.Ft=new Ci(t)}paneView(){return this.Ft}}const Pi={cn:4,_n:1e-4};function Di(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Oi(t,i){const s=Di(t.minValue(),i),e=Di(t.maxValue(),i);return new ci(s,e)}function Ei(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Ni(t,i){const s=Ei(t.minValue(),i),e=Ei(t.maxValue(),i);return new ci(s,e)}function Ri(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const e=kt(s+i._n)+i.cn;return t<0?-e:e}function Ai(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const e=Math.pow(10,s-i.cn)-i._n;return t<0?-e:e}function Li(t,i){if(null===t)return null;const s=Ri(t.minValue(),i),e=Ri(t.maxValue(),i);return new ci(s,e)}function Ii(t,i){if(null===t)return null;const s=Ai(t.minValue(),i),e=Ai(t.maxValue(),i);return new ci(s,e)}function Vi(t){if(null===t)return Pi;const i=Math.abs(t.maxValue()-t.minValue());if(i>=1||i<1e-15)return Pi;const s=Math.ceil(Math.abs(Math.log10(i))),e=Pi.cn+s;return{cn:e,_n:1/Math.pow(10,e)}}class Bi{constructor(t,i){if(this.dn=t,this.fn=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.dn))this.pn=[2,2.5,2];else{this.pn=[];for(let t=this.dn;1!==t;){if(t%2==0)this.pn.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.pn.push(2,2.5),t/=5}if(this.pn.length>100)throw new Error("something wrong with base")}}}vn(t,i,s){const e=0===this.dn?0:1/this.dn;let n=Math.pow(10,Math.max(0,Math.ceil(kt(t-i)))),h=0,r=this.fn[0];for(;;){const t=yt(n,e,1e-14)&&n>e+1e-14,i=yt(n,s*r,1e-14),l=yt(n,1,1e-14);if(!(t&&i&&l))break;n/=r,r=this.fn[++h%this.fn.length]}if(n<=e+1e-14&&(n=e),n=Math.max(1,n),this.pn.length>0&&(l=n,a=1,o=1e-14,Math.abs(l-a)<o))for(h=0,r=this.pn[0];yt(n,s*r,1e-14)&&n>e+1e-14;)n/=r,r=this.pn[++h%this.pn.length];var l,a,o;return n}}class Fi{constructor(t,i,s,e){this.mn=[],this.wt=t,this.dn=i,this.wn=s,this.gn=e}vn(t,i){if(t<i)throw new Error("high < low");const s=this.wt.height(),e=(t-i)*this.bn()/s,n=new Bi(this.dn,[2,2.5,2]),h=new Bi(this.dn,[2,2,2.5]),r=new Bi(this.dn,[2.5,2,2]),l=[];return l.push(n.vn(t,i,e),h.vn(t,i,e),r.vn(t,i,e)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}Mn(){const t=this.wt,i=t.firstValue();if(null===i)return void(this.mn=[]);const s=t.height(),e=this.wn(s-1,i),n=this.wn(0,i),h=this.wt.options().entireTextOnly?this.Sn()/2:0,r=h,l=s-1-h,a=Math.max(e,n),o=Math.min(e,n);if(a===o)return void(this.mn=[]);let u=this.vn(a,o),c=a%u;c+=c<0?u:0;const _=a>=o?1:-1;let d=null,f=0;for(let s=a-c;s>o;s-=u){const e=this.gn(s,i,!0);null!==d&&Math.abs(e-d)<this.bn()||(e<r||e>l||(f<this.mn.length?(this.mn[f].coord=e,this.mn[f].label=t.formatLogical(s)):this.mn.push({coord:e,label:t.formatLogical(s)}),f++,d=e,t.isLog()&&(u=this.vn(s*_,o))))}this.mn.length=f}yn(){return this.mn}Sn(){return this.wt.fontSize()}bn(){return Math.ceil(2.5*this.Sn())}}function zi(t){return t.slice().sort(((t,i)=>r(t.zorder())-r(i.zorder())))}var Wi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Wi||(Wi={}));const ji=new it,$i=new tt(100,1);class Hi{constructor(t,i,s,e){this.kn=0,this.xn=null,this.ue=null,this.Cn=null,this.Tn={Pn:!1,Dn:null},this.On=0,this.En=0,this.Nn=new m,this.Rn=new m,this.An=[],this.Ln=null,this.In=null,this.Vn=null,this.Bn=null,this.Ze=$i,this.Fn=Vi(null),this.zn=t,this.Lt=i,this.Wn=s,this.jn=e,this.$n=new Fi(this,100,this.Hn.bind(this),this.Un.bind(this))}id(){return this.zn}options(){return this.Lt}applyOptions(t){if(w(this.Lt,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){const i=h(t.scaleMargins.top),s=h(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.qn(),this.In=null}}isAutoScale(){return this.Lt.autoScale}isLog(){return 1===this.Lt.mode}isPercentage(){return 2===this.Lt.mode}isIndexedTo100(){return 3===this.Lt.mode}mode(){return{autoScale:this.Lt.autoScale,isInverted:this.Lt.invertScale,mode:this.Lt.mode}}setMode(t){const i=this.mode();let s=null;void 0!==t.autoScale&&(this.Lt.autoScale=t.autoScale),void 0!==t.mode&&(this.Lt.mode=t.mode,2!==t.mode&&3!==t.mode||(this.Lt.autoScale=!0),this.Tn.Pn=!1),1===i.mode&&t.mode!==i.mode&&(!function(t,i){if(null===t)return!1;const s=Ai(t.minValue(),i),e=Ai(t.maxValue(),i);return isFinite(s)&&isFinite(e)}(this.ue,this.Fn)?this.Lt.autoScale=!0:(s=Ii(this.ue,this.Fn),null!==s&&this.setPriceRange(s))),1===t.mode&&t.mode!==i.mode&&(s=Li(this.ue,this.Fn),null!==s&&this.setPriceRange(s));const e=i.mode!==this.Lt.mode;e&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),e&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.Lt.invertScale=t.isInverted,this.Yn()),this.Rn._(i,this.mode())}modeChanged(){return this.Rn}fontSize(){return this.Wn.fontSize}height(){return this.kn}setHeight(t){this.kn!==t&&(this.kn=t,this.qn(),this.In=null)}internalHeight(){if(this.xn)return this.xn;const t=this.height()-this.Xn()-this.Kn();return this.xn=t,t}priceRange(){return this.Zn(),this.ue}setPriceRange(t,i){const s=this.ue;(i||null===s&&null!==t||null!==s&&!s.equals(t))&&(this.In=null,this.ue=t)}isEmpty(){return this.Zn(),0===this.kn||!this.ue||this.ue.isEmpty()}invertedCoordinate(t){return this.isInverted()?t:this.height()-1-t}priceToCoordinate(t,i){return this.isPercentage()?t=Di(t,i):this.isIndexedTo100()&&(t=Ei(t,i)),this.Un(t,i)}pointsArrayToCoordinates(t,i,s){this.Zn();const e=this.Kn(),n=r(this.priceRange()),h=n.minValue(),l=n.maxValue(),a=this.internalHeight()-1,o=this.isInverted(),u=a/(l-h),c=void 0===s?0:s.from,_=void 0===s?t.length:s.to,d=this.Gn();for(let s=c;s<_;s++){const n=t[s],r=n.price;if(isNaN(r))continue;let l=r;null!==d&&(l=d(n.price,i));const a=e+u*(l-h),c=o?a:this.kn-1-a;n.y=c}}barPricesToCoordinates(t,i,s){this.Zn();const e=this.Kn(),n=r(this.priceRange()),h=n.minValue(),l=n.maxValue(),a=this.internalHeight()-1,o=this.isInverted(),u=a/(l-h),c=void 0===s?0:s.from,_=void 0===s?t.length:s.to,d=this.Gn();for(let s=c;s<_;s++){const n=t[s];let r=n.open,l=n.high,a=n.low,c=n.close;null!==d&&(r=d(n.open,i),l=d(n.high,i),a=d(n.low,i),c=d(n.close,i));let _=e+u*(r-h),f=o?_:this.kn-1-_;n.openY=f,_=e+u*(l-h),f=o?_:this.kn-1-_,n.highY=f,_=e+u*(a-h),f=o?_:this.kn-1-_,n.lowY=f,_=e+u*(c-h),f=o?_:this.kn-1-_,n.closeY=f}}coordinateToPrice(t,i){const s=this.Hn(t,i);return this.logicalToPrice(s,i)}logicalToPrice(t,i){let s=t;return this.isPercentage()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.isIndexedTo100()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}dataSources(){return this.An}orderedSources(){if(this.Ln)return this.Ln;let t=[];for(let i=0;i<this.An.length;i++){const s=this.An[i];null===s.zorder()&&s.setZorder(i+1),t.push(s)}return t=zi(t),this.Ln=t,this.Ln}addDataSource(t){-1===this.An.indexOf(t)&&(this.An.push(t),this.updateFormatter(),this.invalidateSourcesCache())}removeDataSource(t){const i=this.An.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.An.splice(i,1),0===this.An.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()}firstValue(){let t=null;for(const i of this.An){const s=i.firstValue();null!==s&&((null===t||s.timePoint<t.timePoint)&&(t=s))}return null===t?null:t.value}isInverted(){return this.Lt.invertScale}marks(){const t=null===this.firstValue();if(null!==this.In&&(t||this.In.Jn===t))return this.In.yn;this.$n.Mn();const i=this.$n.yn();return this.In={yn:i,Jn:t},this.Nn._(),i}onMarksChanged(){return this.Nn}startScale(t){this.isPercentage()||this.isIndexedTo100()||null===this.Vn&&null===this.Cn&&(this.isEmpty()||(this.Vn=this.kn-t,this.Cn=r(this.priceRange()).clone()))}scaleTo(t){if(this.isPercentage()||this.isIndexedTo100())return;if(null===this.Vn)return;this.setMode({autoScale:!1}),(t=this.kn-t)<0&&(t=0);let i=(this.Vn+.2*(this.kn-1))/(t+.2*(this.kn-1));const s=r(this.Cn).clone();i=Math.max(i,.1),s.scaleAroundCenter(i),this.setPriceRange(s)}endScale(){this.isPercentage()||this.isIndexedTo100()||(this.Vn=null,this.Cn=null)}startScroll(t){this.isAutoScale()||null===this.Bn&&null===this.Cn&&(this.isEmpty()||(this.Bn=t,this.Cn=r(this.priceRange()).clone()))}scrollTo(t){if(this.isAutoScale())return;if(null===this.Bn)return;const i=r(this.priceRange()).length()/(this.internalHeight()-1);let s=t-this.Bn;this.isInverted()&&(s*=-1);const e=s*i,n=r(this.Cn).clone();n.shift(e),this.setPriceRange(n,!0),this.In=null}endScroll(){this.isAutoScale()||null!==this.Bn&&(this.Bn=null,this.Cn=null)}formatter(){return this.Ze||this.updateFormatter(),this.Ze}formatPrice(t,i){switch(this.Lt.mode){case 2:return this.formatter().format(Di(t,i));case 3:return this.formatter().format(Ei(t,i));default:return this.de(t)}}formatLogical(t){switch(this.Lt.mode){case 2:case 3:return this.formatter().format(t);default:return this.de(t)}}formatPriceAbsolute(t){return this.de(t,r(this.Qn()).formatter())}formatPricePercentage(t,i){return t=Di(t,i),ji.format(t)}sourcesForAutoScale(){return this.An}recalculatePriceRange(t){this.Tn={Dn:t,Pn:!1}}updateAllViews(){this.An.forEach((t=>t.updateAllViews()))}updateFormatter(){this.In=null;const t=this.Qn();let i=100;null!==t&&(i=Math.round(1/t.minMove())),this.Ze=$i,this.isPercentage()?(this.Ze=ji,i=100):this.isIndexedTo100()?(this.Ze=new tt(100,1),i=100):null!==t&&(this.Ze=t.formatter()),this.$n=new Fi(this,i,this.Hn.bind(this),this.Un.bind(this)),this.$n.Mn()}invalidateSourcesCache(){this.Ln=null}Qn(){return this.An[0]||null}Xn(){return this.isInverted()?this.Lt.scaleMargins.bottom*this.height()+this.En:this.Lt.scaleMargins.top*this.height()+this.On}Kn(){return this.isInverted()?this.Lt.scaleMargins.top*this.height()+this.On:this.Lt.scaleMargins.bottom*this.height()+this.En}Zn(){this.Tn.Pn||(this.Tn.Pn=!0,this.th())}qn(){this.xn=null}Un(t,i){if(this.Zn(),this.isEmpty())return 0;t=this.isLog()&&t?Ri(t,this.Fn):t;const s=r(this.priceRange()),e=this.Kn()+(this.internalHeight()-1)*(t-s.minValue())/s.length();return this.invertedCoordinate(e)}Hn(t,i){if(this.Zn(),this.isEmpty())return 0;const s=this.invertedCoordinate(t),e=r(this.priceRange()),n=e.minValue()+e.length()*((s-this.Kn())/(this.internalHeight()-1));return this.isLog()?Ai(n,this.Fn):n}Yn(){this.In=null,this.$n.Mn()}th(){const t=this.Tn.Dn;if(null===t)return;let i=null;const s=this.sourcesForAutoScale();let e=0,n=0;for(const h of s){if(!h.visible())continue;const s=h.firstValue();if(null===s)continue;const l=h.autoscaleInfo(t.left(),t.right());let a=l&&l.priceRange();if(null!==a){switch(this.Lt.mode){case 1:a=Li(a,this.Fn);break;case 2:a=Oi(a,s.value);break;case 3:a=Ni(a,s.value)}if(i=null===i?a:i.merge(r(a)),null!==l){const t=l.margins();null!==t&&(e=Math.max(e,t.above),n=Math.max(e,t.below))}}}if(e===this.On&&n===this.En||(this.On=e,this.En=n,this.In=null,this.qn()),null!==i){if(i.minValue()===i.maxValue()){const t=this.Qn(),s=5*(null===t||this.isPercentage()||this.isIndexedTo100()?1:t.minMove());this.isLog()&&(i=Ii(i,this.Fn)),i=new ci(i.minValue()-s,i.maxValue()+s),this.isLog()&&(i=Li(i,this.Fn))}if(this.isLog()){const t=Ii(i,this.Fn),s=Vi(t);if(h=s,l=this.Fn,h.cn!==l.cn||h._n!==l._n){const e=null!==this.Cn?Ii(this.Cn,this.Fn):null;this.Fn=s,i=Li(t,s),null!==e&&(this.Cn=Li(e,s))}}this.setPriceRange(i)}else null===this.ue&&(this.setPriceRange(new ci(-.5,.5)),this.Fn=Vi(null));var h,l;this.Tn.Pn=!0}Gn(){return this.isPercentage()?Di:this.isIndexedTo100()?Ei:this.isLog()?t=>Ri(t,this.Fn):null}de(t,i){return void 0===this.jn.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.jn.priceFormatter(t)}}class Ui{constructor(t,i){this.An=[],this.ih=new Map,this.kn=0,this.cs=0,this.sh=1e3,this.Ln=null,this.eh=new m,this.nh=t,this.St=i,this.hh=new Ti(this);const s=i.options();this.rh=this.lh("left",s.leftPriceScale),this.ah=this.lh("right",s.rightPriceScale),this.rh.modeChanged().subscribe(this.oh.bind(this,this.rh),this),this.ah.modeChanged().subscribe(this.oh.bind(this,this.ah),this),this.applyScaleOptions(s)}applyScaleOptions(t){if(t.leftPriceScale&&this.rh.applyOptions(t.leftPriceScale),t.rightPriceScale&&this.ah.applyOptions(t.rightPriceScale),t.localization&&(this.rh.updateFormatter(),this.ah.updateFormatter()),t.overlayPriceScales){const i=Array.from(this.ih.values());for(const s of i){const i=r(s[0].priceScale());i.applyOptions(t.overlayPriceScales),t.localization&&i.updateFormatter()}}}priceScaleById(t){switch(t){case"left":return this.rh;case"right":return this.ah}return this.ih.has(t)?h(this.ih.get(t))[0].priceScale():null}destroy(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.rh.modeChanged().unsubscribeAll(this),this.ah.modeChanged().unsubscribeAll(this),this.An.forEach((t=>{t.destroy&&t.destroy()})),this.eh._()}stretchFactor(){return this.sh}setStretchFactor(t){this.sh=t}model(){return this.St}width(){return this.cs}height(){return this.kn}setWidth(t){this.cs=t,this.updateAllSources()}setHeight(t){this.kn=t,this.rh.setHeight(t),this.ah.setHeight(t),this.An.forEach((i=>{if(this.isOverlay(i)){const s=i.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllSources()}dataSources(){return this.An}isOverlay(t){const i=t.priceScale();return null===i||this.rh!==i&&this.ah!==i}addDataSource(t,i,s){const e=void 0!==s?s:this._h().uh+1;this.dh(t,i,e)}removeDataSource(t){const i=this.An.indexOf(t);n(-1!==i,"removeDataSource: invalid data source"),this.An.splice(i,1);const s=r(t.priceScale()).id();if(this.ih.has(s)){const i=h(this.ih.get(s)),e=i.indexOf(t);-1!==e&&(i.splice(e,1),0===i.length&&this.ih.delete(s))}const e=t.priceScale();e&&e.dataSources().indexOf(t)>=0&&e.removeDataSource(t),null!==e&&(e.invalidateSourcesCache(),this.recalculatePriceScale(e)),this.Ln=null}priceScalePosition(t){return t===this.rh?"left":t===this.ah?"right":"overlay"}leftPriceScale(){return this.rh}rightPriceScale(){return this.ah}startScalePrice(t,i){t.startScale(i)}scalePriceTo(t,i){t.scaleTo(i),this.updateAllSources()}endScalePrice(t){t.endScale()}startScrollPrice(t,i){t.startScroll(i)}scrollPriceTo(t,i){t.scrollTo(i),this.updateAllSources()}endScrollPrice(t){t.endScroll()}updateAllSources(){this.An.forEach((t=>{t.updateAllViews()}))}defaultPriceScale(){let t=null;return this.St.options().rightPriceScale.visible&&0!==this.ah.dataSources().length?t=this.ah:this.St.options().leftPriceScale.visible&&0!==this.rh.dataSources().length?t=this.rh:0!==this.An.length&&(t=this.An[0].priceScale()),null===t&&(t=this.ah),t}defaultVisiblePriceScale(){let t=null;return this.St.options().rightPriceScale.visible?t=this.ah:this.St.options().leftPriceScale.visible&&(t=this.rh),t}recalculatePriceScale(t){null!==t&&t.isAutoScale()&&this.fh(t)}resetPriceScale(t){const i=this.nh.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()}momentaryAutoScale(){this.fh(this.rh),this.fh(this.ah)}recalculate(){this.recalculatePriceScale(this.rh),this.recalculatePriceScale(this.ah),this.An.forEach((t=>{this.isOverlay(t)&&this.recalculatePriceScale(t.priceScale())})),this.updateAllSources(),this.St.lightUpdate()}orderedSources(){return null===this.Ln&&(this.Ln=zi(this.An)),this.Ln}onDestroyed(){return this.eh}grid(){return this.hh}fh(t){const i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.nh.isEmpty()){const i=this.nh.visibleStrictRange();null!==i&&t.recalculatePriceRange(i)}t.updateAllViews()}_h(){const t=this.orderedSources();if(0===t.length)return{ph:0,uh:0};let i=0,s=0;for(let e=0;e<t.length;e++){const n=t[e].zorder();null!==n&&(n<i&&(i=n),n>s&&(s=n))}return{ph:i,uh:s}}dh(t,i,s){let e=this.priceScaleById(i);if(null===e&&(e=this.lh(i,this.St.options().overlayPriceScales)),this.An.push(t),!Z(i)){const s=this.ih.get(i)||[];s.push(t),this.ih.set(i,s)}e.addDataSource(t),t.setPriceScale(e),t.setZorder(s),this.recalculatePriceScale(e),this.Ln=null}oh(t,i,s){i.mode!==s.mode&&this.fh(t)}lh(t,i){const s=Object.assign({visible:!0,autoScale:!0},y(i)),e=new Hi(t,s,this.St.options().layout,this.St.options().localization);return e.setHeight(this.height()),e}}const qi=t=>t.getUTCFullYear();function Yi(t,i,s){return i.replace(/yyyy/g,(t=>Q(qi(t),4))(t)).replace(/yy/g,(t=>Q(qi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>Q((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>Q((t=>t.getUTCDate())(t),2))(t))}class Xi{constructor(t="yyyy-MM-dd",i="default"){this.mh=t,this.wh=i}gh(t){return Yi(t,this.mh,this.wh)}}class Ki{constructor(t){this.bh=t||"%h:%m:%s"}gh(t){return this.bh.replace("%h",Q(t.getUTCHours(),2)).replace("%m",Q(t.getUTCMinutes(),2)).replace("%s",Q(t.getUTCSeconds(),2))}}const Zi={Mh:"yyyy-MM-dd",Sh:"%h:%m:%s",yh:" ",kh:"default"};class Gi{constructor(t={}){const i=Object.assign(Object.assign({},Zi),t);this.xh=new Xi(i.Mh,i.kh),this.Ch=new Ki(i.Sh),this.Th=i.yh}gh(t){return`${this.xh.gh(t)}${this.Th}${this.Ch.gh(t)}`}}class Ji{constructor(t,i=50){this.Ph=0,this.Dh=1,this.Oh=1,this.hs=new Map,this.Eh=new Map,this.Nh=t,this.Rh=i}gh(t){const i=t.yt,s=void 0===i.businessDay?new Date(1e3*i.timestamp).getTime():new Date(Date.UTC(i.businessDay.year,i.businessDay.month-1,i.businessDay.day)).getTime(),e=this.hs.get(s);if(void 0!==e)return e.Ah;if(this.Ph===this.Rh){const t=this.Eh.get(this.Oh);this.Eh.delete(this.Oh),this.hs.delete(h(t)),this.Oh++,this.Ph--}const n=this.Nh(t);return this.hs.set(s,{Ah:n,Lh:this.Dh}),this.Eh.set(this.Dh,s),this.Ph++,this.Dh++,n}}class Qi{constructor(t,i){n(t<=i,"right should be >= left"),this.Ih=t,this.Vh=i}left(){return this.Ih}right(){return this.Vh}count(){return this.Vh-this.Ih+1}contains(t){return this.Ih<=t&&t<=this.Vh}equals(t){return this.Ih===t.left()&&this.Vh===t.right()}}function ts(t,i){return null===t||null===i?t===i:t.equals(i)}class is{constructor(){this.Bh=new Map,this.hs=null}Fh(t,i){this.zh(i),this.hs=null;for(let s=i;s<t.length;++s){const i=t[s];let e=this.Bh.get(i.timeWeight);void 0===e&&(e=[],this.Bh.set(i.timeWeight,e)),e.push({Wh:s,yt:i.time,jh:i.timeWeight,$h:i.originalTime})}}Hh(t,i){const s=Math.ceil(i/t);return null!==this.hs&&this.hs.Uh===s||(this.hs={yn:this.qh(s),Uh:s}),this.hs.yn}zh(t){if(0===t)return void this.Bh.clear();const i=[];this.Bh.forEach(((s,e)=>{t<=s[0].Wh?i.push(e):s.splice(ct(s,t,(i=>i.Wh<t)),1/0)}));for(const t of i)this.Bh.delete(t)}qh(t){let i=[];for(const s of Array.from(this.Bh.keys()).sort(((t,i)=>i-t))){if(!this.Bh.get(s))continue;const e=i;i=[];const n=e.length;let r=0;const l=h(this.Bh.get(s)),a=l.length;let o=1/0,u=-1/0;for(let s=0;s<a;s++){const h=l[s],a=h.Wh;for(;r<n;){const t=e[r],s=t.Wh;if(!(s<a)){o=s;break}r++,i.push(t),u=s,o=1/0}o-a>=t&&a-u>=t&&(i.push(h),u=a)}for(;r<n;r++)i.push(e[r])}return i}}class ss{constructor(t){this.Yh=t}Xh(){return null===this.Yh?null:new Qi(Math.floor(this.Yh.left()),Math.ceil(this.Yh.right()))}Kh(){return this.Yh}static Zh(){return new ss(null)}}var es,ns,hs,rs,ls;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(es||(es={}));class as{constructor(t,i,s){this.cs=0,this.Gh=null,this.Jh=[],this.Bn=null,this.Vn=null,this.Qh=new is,this.tr=new Map,this.ir=ss.Zh(),this.sr=!0,this.er=new m,this.nr=new m,this.hr=new m,this.rr=null,this.lr=null,this.ar=[],this.Lt=i,this.jn=s,this.ur=i.rightOffset,this.cr=i.barSpacing,this.St=t,this._r()}options(){return this.Lt}applyLocalizationOptions(t){w(this.jn,t),this.dr(),this._r()}applyOptions(t,i){var s;w(this.Lt,t),this.Lt.fixLeftEdge&&this.pr(),this.Lt.fixRightEdge&&this.vr(),void 0!==t.barSpacing&&this.St.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.St.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this.St.setBarSpacing(null!==(s=t.barSpacing)&&void 0!==s?s:this.cr),this.dr(),this._r(),this.hr._()}indexToTime(t){var i,s;return null!==(s=null===(i=this.Jh[t])||void 0===i?void 0:i.time)&&void 0!==s?s:null}indexToTimeScalePoint(t){var i;return null!==(i=this.Jh[t])&&void 0!==i?i:null}timeToIndex(t,i){if(this.Jh.length<1)return null;if(t.timestamp>this.Jh[this.Jh.length-1].time.timestamp)return i?this.Jh.length-1:null;const s=ct(this.Jh,t.timestamp,((t,i)=>t.time.timestamp<i));return t.timestamp<this.Jh[s].time.timestamp?i?s:null:s}isEmpty(){return 0===this.cs||0===this.Jh.length||null===this.Gh}visibleStrictRange(){return this.mr(),this.ir.Xh()}visibleLogicalRange(){return this.mr(),this.ir.Kh()}visibleTimeRange(){const t=this.visibleStrictRange();if(null===t)return null;const i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)}timeRangeForLogicalRange(t){const i=Math.round(t.from),s=Math.round(t.to),e=r(this.wr()),n=r(this.gr());return{from:r(this.indexToTime(Math.max(e,i))),to:r(this.indexToTime(Math.min(n,s)))}}logicalRangeForTimeRange(t){return{from:r(this.timeToIndex(t.from,!0)),to:r(this.timeToIndex(t.to,!0))}}width(){return this.cs}setWidth(t){if(!isFinite(t)||t<=0)return;if(this.cs===t)return;const i=this.visibleLogicalRange(),s=this.cs;if(this.cs=t,this.sr=!0,this.Lt.lockVisibleTimeRangeOnResize&&0!==s){const i=this.cr*t/s;this.cr=i}if(this.Lt.fixLeftEdge&&null!==i&&i.left()<=0){const i=s-t;this.ur-=Math.round(i/this.cr)+1,this.sr=!0}this.br(),this.Mr()}indexToCoordinate(t){if(this.isEmpty()||!b(t))return 0;const i=this.baseIndex()+this.ur-t;return this.cs-(i+.5)*this.cr-1}indexesToCoordinates(t,i){const s=this.baseIndex(),e=void 0===i?0:i.from,n=void 0===i?t.length:i.to;for(let i=e;i<n;i++){const e=t[i].time,n=s+this.ur-e,h=this.cs-(n+.5)*this.cr-1;t[i].x=h}}coordinateToIndex(t){return Math.ceil(this.Sr(t))}setRightOffset(t){this.sr=!0,this.ur=t,this.Mr(),this.St.recalculateAllPanes(),this.St.lightUpdate()}barSpacing(){return this.cr}setBarSpacing(t){this.yr(t),this.Mr(),this.St.recalculateAllPanes(),this.St.lightUpdate()}rightOffset(){return this.ur}marks(){if(this.isEmpty())return null;if(null!==this.lr)return this.lr;const t=this.cr,i=5*(this.St.options().layout.fontSize+4),s=Math.round(i/t),e=r(this.visibleStrictRange()),n=Math.max(e.left(),e.left()-s),h=Math.max(e.right(),e.right()-s),l=this.Qh.Hh(t,i),a=this.wr()+s,o=this.gr()-s,u=this.kr(),c=this.Lt.fixLeftEdge||u,_=this.Lt.fixRightEdge||u;let d=0;for(const t of l){if(!(n<=t.Wh&&t.Wh<=h))continue;let s;d<this.ar.length?(s=this.ar[d],s.coord=this.indexToCoordinate(t.Wh),s.label=this.Cr(t),s.weight=t.jh):(s={needAlignCoordinate:!1,coord:this.indexToCoordinate(t.Wh),label:this.Cr(t),weight:t.jh},this.ar.push(s)),this.cr>i/2&&!u?s.needAlignCoordinate=!1:s.needAlignCoordinate=c&&t.Wh<=a||_&&t.Wh>=o,d++}return this.ar.length=d,this.lr=this.ar,this.ar}restoreDefault(){this.sr=!0,this.setBarSpacing(this.Lt.barSpacing),this.setRightOffset(this.Lt.rightOffset)}setBaseIndex(t){this.sr=!0,this.Gh=t,this.Mr(),this.pr()}zoom(t,i){const s=this.Sr(t),e=this.barSpacing(),n=e+i*(e/10);this.setBarSpacing(n),this.Lt.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(s-this.Sr(t)))}startScale(t){this.Bn&&this.endScroll(),null===this.Vn&&null===this.rr&&(this.isEmpty()||(this.Vn=t,this.Tr()))}scaleTo(t){if(null===this.rr)return;const i=St(this.cs-t,0,this.cs),s=St(this.cs-r(this.Vn),0,this.cs);0!==i&&0!==s&&this.setBarSpacing(this.rr.Ri*i/s)}endScale(){null!==this.Vn&&(this.Vn=null,this.Pr())}startScroll(t){null===this.Bn&&null===this.rr&&(this.isEmpty()||(this.Bn=t,this.Tr()))}scrollTo(t){if(null===this.Bn)return;const i=(this.Bn-t)/this.barSpacing();this.ur=r(this.rr).Dr+i,this.sr=!0,this.Mr()}endScroll(){null!==this.Bn&&(this.Bn=null,this.Pr())}scrollToRealTime(){this.scrollToOffsetAnimated(this.Lt.rightOffset)}scrollToOffsetAnimated(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.ur,e=performance.now(),n=()=>{const h=(performance.now()-e)/i,r=h>=1,l=r?t:s+(t-s)*h;this.setRightOffset(l),r||setTimeout(n,20)};n()}update(t,i){this.sr=!0,this.Jh=t,this.Qh.Fh(t,i),this.Mr()}visibleBarsChanged(){return this.er}logicalRangeChanged(){return this.nr}optionsApplied(){return this.hr}baseIndex(){return this.Gh||0}setVisibleRange(t){const i=t.count();this.yr(this.cs/i),this.ur=t.right()-this.baseIndex(),this.Mr(),this.sr=!0,this.St.recalculateAllPanes(),this.St.lightUpdate()}fitContent(){const t=this.wr(),i=this.gr();null!==t&&null!==i&&this.setVisibleRange(new Qi(t,i+this.Lt.rightOffset))}setLogicalRange(t){const i=new Qi(t.from,t.to);this.setVisibleRange(i)}formatDateTime(t){return void 0!==this.jn.timeFormatter?this.jn.timeFormatter(t.originalTime):this.Or.gh(new Date(1e3*t.time.timestamp))}kr(){const{handleScroll:t,handleScale:i}=this.St.options();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}wr(){return 0===this.Jh.length?null:0}gr(){return 0===this.Jh.length?null:this.Jh.length-1}Er(t){return(this.cs-1-t)/this.cr}Sr(t){const i=this.Er(t),s=this.baseIndex()+this.ur-i;return Math.round(1e6*s)/1e6}yr(t){const i=this.cr;this.cr=t,this.br(),i!==this.cr&&(this.sr=!0,this.Nr())}mr(){if(!this.sr)return;if(this.sr=!1,this.isEmpty())return void this.Rr(ss.Zh());const t=this.baseIndex(),i=this.cs/this.cr,s=this.ur+t,e=new Qi(s-i+1,s);this.Rr(new ss(e))}br(){const t=this.Ar();if(this.cr<t&&(this.cr=t,this.sr=!0),0!==this.cs){const t=.5*this.cs;this.cr>t&&(this.cr=t,this.sr=!0)}}Ar(){return this.Lt.fixLeftEdge&&this.Lt.fixRightEdge&&0!==this.Jh.length?this.cs/this.Jh.length:this.Lt.minBarSpacing}Mr(){const t=this.Lr();this.ur>t&&(this.ur=t,this.sr=!0);const i=this.Ir();null!==i&&this.ur<i&&(this.ur=i,this.sr=!0)}Ir(){const t=this.wr(),i=this.Gh;if(null===t||null===i)return null;return t-i-1+(this.Lt.fixLeftEdge?this.cs/this.cr:Math.min(2,this.Jh.length))}Lr(){return this.Lt.fixRightEdge?0:this.cs/this.cr-Math.min(2,this.Jh.length)}Tr(){this.rr={Ri:this.barSpacing(),Dr:this.rightOffset()}}Pr(){this.rr=null}Cr(t){let i=this.tr.get(t.jh);return void 0===i&&(i=new Ji((t=>this.Vr(t))),this.tr.set(t.jh,i)),i.gh(t)}Vr(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.jh,this.Lt.timeVisible,this.Lt.secondsVisible);return void 0!==this.Lt.tickMarkFormatter?this.Lt.tickMarkFormatter(t.$h,i,this.jn.locale):function(t,i,s){const e={};switch(i){case 0:e.year="numeric";break;case 1:e.month="short";break;case 2:e.day="numeric";break;case 3:e.hour12=!1,e.hour="2-digit",e.minute="2-digit";break;case 4:e.hour12=!1,e.hour="2-digit",e.minute="2-digit",e.second="2-digit"}const n=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()).toLocaleString(s,e)}(t.yt,i,this.jn.locale)}Rr(t){const i=this.ir;this.ir=t,ts(i.Xh(),this.ir.Xh())||this.er._(),ts(i.Kh(),this.ir.Kh())||this.nr._(),this.Nr()}Nr(){this.lr=null}dr(){this.Nr(),this.tr.clear()}_r(){const t=this.jn.dateFormat;this.Lt.timeVisible?this.Or=new Gi({Mh:t,Sh:this.Lt.secondsVisible?"%h:%m:%s":"%h:%m",yh:"   ",kh:this.jn.locale}):this.Or=new Xi(t,this.jn.locale)}pr(){if(!this.Lt.fixLeftEdge)return;const t=this.wr();if(null===t)return;const i=this.visibleStrictRange();if(null===i)return;const s=i.left()-t;if(s<0){const t=this.ur-s-1;this.setRightOffset(t)}this.br()}vr(){this.Mr(),this.br()}}class os extends O{constructor(t){super(),this.Br=new Map,this.U=t}P(t){}D(t){if(!this.U.q)return;t.save();let i=0;for(const s of this.U.Fr){if(0===s.Zs.length)continue;t.font=s.zr;const e=this.Wr(t,s.Zs);e>this.U.Ss?s.jr=this.U.Ss/e:s.jr=1,i+=s.$r*s.jr}let s=0;switch(this.U.Hr){case"top":s=0;break;case"center":s=Math.max((this.U.Ms-i)/2,0);break;case"bottom":s=Math.max(this.U.Ms-i,0)}t.fillStyle=this.U.it;for(const i of this.U.Fr){t.save();let e=0;switch(this.U.Ur){case"left":t.textAlign="left",e=i.$r/2;break;case"center":t.textAlign="center",e=this.U.Ss/2;break;case"right":t.textAlign="right",e=this.U.Ss-1-i.$r/2}t.translate(e,s),t.textBaseline="top",t.font=i.zr,t.scale(i.jr,i.jr),t.fillText(i.Zs,0,i.qr),t.restore(),s+=i.$r*i.jr}t.restore()}Wr(t,i){const s=this.Yr(t.font);let e=s.get(i);return void 0===e&&(e=t.measureText(i).width,s.set(i,e)),e}Yr(t){let i=this.Br.get(t);return void 0===i&&(i=new Map,this.Br.set(t,i)),i}}class us{constructor(t){this.j=!0,this.et={q:!1,it:"",Ms:0,Ss:0,Fr:[],Hr:"center",Ur:"center"},this.nt=new os(this.et),this.ht=t}update(){this.j=!0}renderer(t,i){return this.j&&(this.H(t,i),this.j=!1),this.nt}H(t,i){const s=this.ht.options(),e=this.et;e.q=s.visible,e.q&&(e.it=s.color,e.Ss=i,e.Ms=t,e.Ur=s.horzAlign,e.Hr=s.vertAlign,e.Fr=[{Zs:s.text,zr:T(s.fontSize,s.fontFamily,s.fontStyle),$r:1.2*s.fontSize,qr:0,jr:0}])}}class cs extends Y{constructor(t,i){super(),this.Lt=i,this.Ft=new us(this)}priceAxisViews(){return[]}paneViews(){return[this.Ft]}options(){return this.Lt}updateAllViews(){this.Ft.update()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(ns||(ns={}));class _s{constructor(t,i){this.Xr=[],this.Kr=[],this.cs=0,this.Zr=null,this.Gr=null,this.Jr=new m,this.Qr=new m,this.tl=null,this.il=t,this.Lt=i,this.sl=new P(this),this.nh=new as(this,i.timeScale,this.Lt.localization),this.$=new K(this,i.crosshair),this.el=new ki(i.crosshair),this.nl=new cs(this,i.watermark),this.createPane(),this.Xr[0].setStretchFactor(2e3),this.hl=this.rl(0),this.ll=this.rl(1)}fullUpdate(){this.al(new G(3))}lightUpdate(){this.al(new G(2))}cursorUpdate(){this.al(new G(1))}updateSource(t){const i=this.ol(t);this.al(i)}hoveredSource(){return this.Gr}setHoveredSource(t){const i=this.Gr;this.Gr=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)}options(){return this.Lt}applyOptions(t){w(this.Lt,t),this.Xr.forEach((i=>i.applyScaleOptions(t))),void 0!==t.timeScale&&this.nh.applyOptions(t.timeScale),void 0!==t.localization&&this.nh.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Jr._(),this.hl=this.rl(0),this.ll=this.rl(1),this.fullUpdate()}applyPriceScaleOptions(t,i){if("left"===t)return void this.applyOptions({leftPriceScale:i});if("right"===t)return void this.applyOptions({rightPriceScale:i});const s=this.findPriceScale(t);null!==s&&(s.priceScale.applyOptions(i),this.Jr._())}findPriceScale(t){for(const i of this.Xr){const s=i.priceScaleById(t);if(null!==s)return{pane:i,priceScale:s}}return null}timeScale(){return this.nh}panes(){return this.Xr}watermarkSource(){return this.nl}crosshairSource(){return this.$}crosshairMoved(){return this.Qr}setPaneHeight(t,i){t.setHeight(i),this.recalculateAllPanes()}setWidth(t){this.cs=t,this.nh.setWidth(this.cs),this.Xr.forEach((i=>i.setWidth(t))),this.recalculateAllPanes()}createPane(t){const i=new Ui(this.nh,this);void 0!==t?this.Xr.splice(t,0,i):this.Xr.push(i);const s=void 0===t?this.Xr.length-1:t,e=new G(3);return e.invalidatePane(s,{level:0,autoScale:!0}),this.al(e),i}startScalePrice(t,i,s){t.startScalePrice(i,s)}scalePriceTo(t,i,s){t.scalePriceTo(i,s),this.updateCrosshair(),this.al(this.ul(t,2))}endScalePrice(t,i){t.endScalePrice(i),this.al(this.ul(t,2))}startScrollPrice(t,i,s){i.isAutoScale()||t.startScrollPrice(i,s)}scrollPriceTo(t,i,s){i.isAutoScale()||(t.scrollPriceTo(i,s),this.updateCrosshair(),this.al(this.ul(t,2)))}endScrollPrice(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.al(this.ul(t,2)))}resetPriceScale(t,i){t.resetPriceScale(i),this.al(this.ul(t,2))}startScaleTime(t){this.nh.startScale(t)}zoomTime(t,i){const s=this.timeScale();if(s.isEmpty()||0===i)return;const e=s.width();t=Math.max(1,Math.min(t,e)),s.zoom(t,i),this.recalculateAllPanes()}scrollChart(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()}scaleTimeTo(t){this.nh.scaleTo(t),this.recalculateAllPanes()}endScaleTime(){this.nh.endScale(),this.lightUpdate()}startScrollTime(t){this.Zr=t,this.nh.startScroll(t)}scrollTimeTo(t){let i=!1;return null!==this.Zr&&Math.abs(t-this.Zr)>20&&(this.Zr=null,i=!0),this.nh.scrollTo(t),this.recalculateAllPanes(),i}endScrollTime(){this.nh.endScroll(),this.lightUpdate(),this.Zr=null}serieses(){return this.Kr}setAndSaveCurrentPosition(t,i,s){this.$.saveOriginCoord(t,i);let e=NaN,n=this.nh.coordinateToIndex(t);const h=this.nh.visibleStrictRange();null!==h&&(n=Math.min(Math.max(h.left(),n),h.right()));const r=s.defaultPriceScale(),l=r.firstValue();null!==l&&(e=r.coordinateToPrice(i,l)),e=this.el.tn(e,n,s),this.$.setPosition(n,e,s),this.cursorUpdate(),this.Qr._(this.$.appliedIndex(),{x:t,y:i})}clearCurrentPosition(){this.crosshairSource().clearPosition(),this.cursorUpdate(),this.Qr._(null,null)}updateCrosshair(){const t=this.$.pane();if(null!==t){const i=this.$.originCoordX(),s=this.$.originCoordY();this.setAndSaveCurrentPosition(i,s,t)}this.$.updateAllViews()}updateTimeScale(t,i,s){const e=this.nh.indexToTime(0);void 0!==i&&void 0!==s&&this.nh.update(i,s);const n=this.nh.indexToTime(0),h=this.nh.baseIndex(),r=this.nh.visibleStrictRange();if(null!==r&&null!==e&&null!==n){const i=r.contains(h),s=e.timestamp>n.timestamp,l=null!==t&&t>h&&!s,a=i&&this.nh.options().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-h;this.nh.setRightOffset(this.nh.rightOffset()-i)}}this.nh.setBaseIndex(t)}recalculatePane(t){null!==t&&t.recalculate()}paneForSource(t){const i=this.Xr.find((i=>i.orderedSources().includes(t)));return void 0===i?null:i}recalculateAllPanes(){this.nl.updateAllViews(),this.Xr.forEach((t=>t.recalculate())),this.updateCrosshair()}destroy(){this.Xr.forEach((t=>t.destroy())),this.Xr.length=0,this.Lt.localization.priceFormatter=void 0,this.Lt.localization.timeFormatter=void 0}rendererOptionsProvider(){return this.sl}priceAxisRendererOptions(){return this.sl.options()}priceScalesOptionsChanged(){return this.Jr}createSeries(t,i){const s=this.Xr[0],e=this.cl(i,t,s);return this.Kr.push(e),1===this.Kr.length?this.fullUpdate():this.lightUpdate(),e}removeSeries(t){const i=this.paneForSource(t),s=this.Kr.indexOf(t);n(-1!==s,"Series not found"),this.Kr.splice(s,1),r(i).removeDataSource(t),t.destroy&&t.destroy()}moveSeriesToScale(t,i){const s=r(this.paneForSource(t));s.removeDataSource(t);const e=this.findPriceScale(i);if(null===e){const e=t.zorder();s.addDataSource(t,i,e)}else{const n=e.pane===s?t.zorder():void 0;e.pane.addDataSource(t,i,n)}}fitContent(){const t=new G(2);t.setFitContent(),this.al(t)}setTargetLogicalRange(t){const i=new G(2);i.applyRange(t),this.al(i)}resetTimeScale(){const t=new G(2);t.resetTimeScale(),this.al(t)}setBarSpacing(t){const i=new G(2);i.setBarSpacing(t),this.al(i)}setRightOffset(t){const i=new G(2);i.setRightOffset(t),this.al(i)}defaultVisiblePriceScaleId(){return this.Lt.rightPriceScale.visible?"right":"left"}backgroundBottomColor(){return this.ll}backgroundTopColor(){return this.hl}backgroundColorAtYPercentFromTop(t){const i=this.ll,s=this.hl;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.tl||this.tl.ri!==s||this.tl.li!==i)this.tl={ri:s,li:i,_l:new Map};else{const i=this.tl._l.get(t);if(void 0!==i)return i}const e=function(t,i,s){const[e,n,h,r]=p(t),[l,a,c,_]=p(i),d=[o(e+s*(l-e)),o(n+s*(a-n)),o(h+s*(c-h)),u(r+s*(_-r))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.tl._l.set(t,e),e}ul(t,i){const s=new G(i);if(null!==t){const e=this.Xr.indexOf(t);s.invalidatePane(e,{level:i})}return s}ol(t,i){return void 0===i&&(i=2),this.ul(this.paneForSource(t),i)}al(t){this.il&&this.il(t),this.Xr.forEach((t=>t.grid().paneView().update()))}cl(t,i,s){const e=new yi(this,t,i),n=void 0!==t.priceScaleId?t.priceScaleId:this.defaultVisiblePriceScaleId();return s.addDataSource(e,n),Z(n)||e.applyOptions(t),e}rl(t){const i=this.Lt.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ds(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function fs(t){return!g(t)&&!M(t)}function ps(t){return g(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(hs||(hs={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(rs||(rs={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(ls||(ls={}));var vs={allowDownsampling:!0};var ms=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();class ws{constructor(t,i){this.G=t,this.J=i}dl(t){return this.G===t.G&&this.J===t.J}}function gs(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function bs(t){const i=r(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function Ms(t,i){const s=t.createElement("canvas"),e=gs(s);return s.style.width=`${i.G}px`,s.style.height=`${i.J}px`,s.width=i.G*e,s.height=i.J*e,s}function Ss(t,i){const s=r(t.ownerDocument).createElement("canvas");t.appendChild(s);const e=function(t,i){return void 0===i&&(i=vs),new ms(t,i)}(s,{allowDownsampling:!1});return e.resizeCanvas({width:i.G,height:i.J}),e}function ys(t,i){return t.fl-i.fl}function ks(t,i,s){const e=(t.fl-i.fl)/(t.yt-i.yt);return Math.sign(e)*Math.min(Math.abs(e),s)}class xs{constructor(t,i,s,e){this.pl=null,this.vl=null,this.ml=null,this.wl=null,this.gl=null,this.bl=0,this.Ml=0,this.Sl=!1,this.yl=t,this.kl=i,this.xl=s,this.Kt=e}Cl(t,i){if(null!==this.pl){if(this.pl.yt===i)return void(this.pl.fl=t);if(Math.abs(this.pl.fl-t)<this.Kt)return}this.wl=this.ml,this.ml=this.vl,this.vl=this.pl,this.pl={yt:i,fl:t}}Es(t,i){if(null===this.pl||null===this.vl)return;if(i-this.pl.yt>50)return;let s=0;const e=ks(this.pl,this.vl,this.kl),n=ys(this.pl,this.vl),h=[e],r=[n];if(s+=n,null!==this.ml){const t=ks(this.vl,this.ml,this.kl);if(Math.sign(t)===Math.sign(e)){const i=ys(this.vl,this.ml);if(h.push(t),r.push(i),s+=i,null!==this.wl){const t=ks(this.ml,this.wl,this.kl);if(Math.sign(t)===Math.sign(e)){const i=ys(this.ml,this.wl);h.push(t),r.push(i),s+=i}}}}let l=0;for(let t=0;t<h.length;++t)l+=r[t]/s*h[t];Math.abs(l)<this.yl||(this.gl={fl:t,yt:i},this.Ml=l,this.bl=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.xl))}Tl(t){const i=r(this.gl),s=t-i.yt;return i.fl+this.Ml*(Math.pow(this.xl,s)-1)/Math.log(this.xl)}Pl(t){return null===this.gl||this.Dl(t)===this.bl}Ol(){return this.Sl}El(){this.Sl=!0}Dl(t){const i=t-r(this.gl).yt;return Math.min(i,this.bl)}}const Cs="undefined"!=typeof window;function Ts(){return!!Cs&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Ps(){return!!Cs&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ds(t){Cs&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Os{constructor(t,i,s){this.Nl=0,this.Rl=null,this.Al={K:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY},this.Ll=0,this.Il=null,this.Vl={K:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY},this.Bl=null,this.Fl=!1,this.zl=null,this.Wl=null,this.jl=!1,this.$l=!1,this.Hl=!1,this.Ul=null,this.ql=null,this.Yl=null,this.Xl=null,this.Kl=null,this.Zl=null,this.Gl=null,this.Jl=0,this.Ql=!1,this.ta=!1,this.ia=!1,this.sa=0,this.ea=null,this.na=!Ps(),this.ha=t=>{this.ra(t)},this.la=t=>{if(this.aa(t)){const i=this.oa(t);if(++this.Ll,this.Il&&this.Ll>1){const{ua:s}=this.ca(Rs(t),this.Vl);s<30&&!this.Hl&&this._a(i,this.fa.da),this.pa()}}else{const i=this.oa(t);if(++this.Nl,this.Rl&&this.Nl>1){const{ua:s}=this.ca(Rs(t),this.Al);s<5&&!this.$l&&this.va(i,this.fa.ma),this.wa()}}},this.ga=t,this.fa=i,this.Lt=s,this.ba()}destroy(){null!==this.Ul&&(this.Ul(),this.Ul=null),null!==this.ql&&(this.ql(),this.ql=null),null!==this.Xl&&(this.Xl(),this.Xl=null),null!==this.Kl&&(this.Kl(),this.Kl=null),null!==this.Zl&&(this.Zl(),this.Zl=null),null!==this.Yl&&(this.Yl(),this.Yl=null),this.Ma(),this.wa()}Sa(t){this.Xl&&this.Xl();const i=this.ya.bind(this);if(this.Xl=()=>{this.ga.removeEventListener("mousemove",i)},this.ga.addEventListener("mousemove",i),this.aa(t))return;const s=this.oa(t);this.va(s,this.fa.ka),this.na=!0}wa(){null!==this.Rl&&clearTimeout(this.Rl),this.Nl=0,this.Rl=null,this.Al={K:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY}}pa(){null!==this.Il&&clearTimeout(this.Il),this.Ll=0,this.Il=null,this.Vl={K:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY}}ya(t){if(this.ia||null!==this.Wl)return;if(this.aa(t))return;const i=this.oa(t);this.va(i,this.fa.xa),this.na=!0}Ca(t){const i=Ls(t.changedTouches,r(this.ea));if(null===i)return;if(this.sa=As(t),null!==this.Gl)return;if(this.ta)return;this.Ql=!0;const s=this.ca(Rs(i),r(this.Wl)),{Ta:e,Pa:n,ua:h}=s;if(this.jl||!(h<5)){if(!this.jl){const t=.5*e,i=n>=t&&!this.Lt.Da(),s=t>n&&!this.Lt.Oa();i||s||(this.ta=!0),this.jl=!0,this.Hl=!0,this.Ma(),this.pa()}if(!this.ta){const s=this.oa(t,i);this._a(s,this.fa.Ea),Ns(t)}}}Na(t){if(0!==t.button)return;const i=this.ca(Rs(t),r(this.zl)),{ua:s}=i;if(s>=5&&(this.$l=!0,this.wa()),this.$l){const i=this.oa(t);this.va(i,this.fa.Ra)}}ca(t,i){const s=Math.abs(i.K-t.K),e=Math.abs(i.Z-t.Z);return{Ta:s,Pa:e,ua:s+e}}Aa(t){let i=Ls(t.changedTouches,r(this.ea));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.ea=null,this.sa=As(t),this.Ma(),this.Wl=null,this.Zl&&(this.Zl(),this.Zl=null);const s=this.oa(t,i);if(this._a(s,this.fa.La),++this.Ll,this.Il&&this.Ll>1){const{ua:t}=this.ca(Rs(i),this.Vl);t<30&&!this.Hl&&this._a(s,this.fa.da),this.pa()}else this.Hl||(this._a(s,this.fa.Ia),this.fa.Ia&&Ns(t));0===this.Ll&&Ns(t),0===t.touches.length&&this.Fl&&(this.Fl=!1,Ns(t))}ra(t){if(0!==t.button)return;const i=this.oa(t);if(this.zl=null,this.ia=!1,this.Kl&&(this.Kl(),this.Kl=null),Ts()){this.ga.ownerDocument.documentElement.removeEventListener("mouseleave",this.ha)}if(!this.aa(t))if(this.va(i,this.fa.Va),++this.Nl,this.Rl&&this.Nl>1){const{ua:s}=this.ca(Rs(t),this.Al);s<5&&!this.$l&&this.va(i,this.fa.ma),this.wa()}else this.$l||this.va(i,this.fa.Ba)}Ma(){null!==this.Bl&&(clearTimeout(this.Bl),this.Bl=null)}Fa(t){if(null!==this.ea)return;const i=t.changedTouches[0];this.ea=i.identifier,this.sa=As(t);const s=this.ga.ownerDocument.documentElement;this.Hl=!1,this.jl=!1,this.ta=!1,this.Wl=Rs(i),this.Zl&&(this.Zl(),this.Zl=null);{const i=this.Ca.bind(this),e=this.Aa.bind(this);this.Zl=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",e)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",e,{passive:!1}),this.Ma(),this.Bl=setTimeout(this.za.bind(this,t),240)}const e=this.oa(t,i);this._a(e,this.fa.Wa),this.Il||(this.Ll=0,this.Il=setTimeout(this.pa.bind(this),500),this.Vl=Rs(i))}ja(t){if(0!==t.button)return;const i=this.ga.ownerDocument.documentElement;Ts()&&i.addEventListener("mouseleave",this.ha),this.$l=!1,this.zl=Rs(t),this.Kl&&(this.Kl(),this.Kl=null);{const t=this.Na.bind(this),s=this.ra.bind(this);this.Kl=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.ia=!0,this.aa(t))return;const s=this.oa(t);this.va(s,this.fa.$a),this.Rl||(this.Nl=0,this.Rl=setTimeout(this.wa.bind(this),500),this.Al=Rs(t))}ba(){this.ga.addEventListener("mouseenter",this.Sa.bind(this)),this.ga.addEventListener("touchcancel",this.Ma.bind(this));{const t=this.ga.ownerDocument,i=t=>{this.fa.Ha&&(t.composed&&this.ga.contains(t.composedPath()[0])||t.target&&this.ga.contains(t.target)||this.fa.Ha())};this.ql=()=>{t.removeEventListener("touchstart",i)},this.Ul=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}Ps()&&(this.Yl=()=>{this.ga.removeEventListener("dblclick",this.la)},this.ga.addEventListener("dblclick",this.la)),this.ga.addEventListener("mouseleave",this.Ua.bind(this)),this.ga.addEventListener("touchstart",this.Fa.bind(this),{passive:!0}),Ds(this.ga),this.ga.addEventListener("mousedown",this.ja.bind(this)),this.qa(),this.ga.addEventListener("touchmove",(()=>{}),{passive:!1})}qa(){void 0===this.fa.Ya&&void 0===this.fa.Xa&&void 0===this.fa.Ka||(this.ga.addEventListener("touchstart",(t=>this.Za(t.touches)),{passive:!0}),this.ga.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.Gl&&void 0!==this.fa.Xa){const i=Es(t.touches[0],t.touches[1])/this.Jl;this.fa.Xa(this.Gl,i),Ns(t)}}),{passive:!1}),this.ga.addEventListener("touchend",(t=>{this.Za(t.touches)})))}Za(t){1===t.length&&(this.Ql=!1),2!==t.length||this.Ql||this.Fl?this.Ga():this.Ja(t)}Ja(t){const i=this.ga.getBoundingClientRect()||{left:0,top:0};this.Gl={K:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,Z:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Jl=Es(t[0],t[1]),void 0!==this.fa.Ya&&this.fa.Ya(),this.Ma()}Ga(){null!==this.Gl&&(this.Gl=null,void 0!==this.fa.Ka&&this.fa.Ka())}Ua(t){if(this.Xl&&this.Xl(),this.aa(t))return;if(!this.na)return;const i=this.oa(t);this.va(i,this.fa.Qa),this.na=!Ps()}za(t){const i=Ls(t.touches,r(this.ea));if(null===i)return;const s=this.oa(t,i);this._a(s,this.fa.io),this.Hl=!0,this.Fl=!0}aa(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:As(t)<this.sa+500}_a(t,i){i&&i.call(this.fa,t)}va(t,i){i&&i.call(this.fa,t)}oa(t,i){const s=i||t,e=this.ga.getBoundingClientRect()||{left:0,top:0};return{so:s.clientX,eo:s.clientY,no:s.pageX,ho:s.pageY,ro:s.screenX,lo:s.screenY,ao:s.clientX-e.left,oo:s.clientY-e.top,uo:t.ctrlKey,co:t.altKey,_o:t.shiftKey,do:t.metaKey,fo:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,po:t.type,vo:s.target,mo:t.view,wo:()=>{"touchstart"!==t.type&&Ns(t)}}}}function Es(t,i){const s=t.clientX-i.clientX,e=t.clientY-i.clientY;return Math.sqrt(s*s+e*e)}function Ns(t){t.cancelable&&t.preventDefault()}function Rs(t){return{K:t.pageX,Z:t.pageY}}function As(t){return t.timeStamp||performance.now()}function Ls(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Is{constructor(t,i,s,e){this._s=new Bt(200),this.M=0,this.bo="",this.vs="",this.ls=[],this.Mo=new Map,this.M=t,this.bo=i,this.vs=T(t,s,e)}destroy(){this._s.reset(),this.ls=[],this.Mo.clear()}So(t,i,s,e,n){const h=this.yo(t,i);if("left"!==n){const i=gs(t.canvas);s-=Math.floor(h.ko*i)}e-=Math.floor(h.Ms/2),t.drawImage(h.xo,s,e,h.Ss,h.Ms)}yo(t,i){let s;if(this.Mo.has(i))s=h(this.Mo.get(i));else{if(this.ls.length>=200){const t=h(this.ls.shift());this.Mo.delete(t)}const e=gs(t.canvas),n=Math.ceil(this.M/4.5),r=Math.round(this.M/10),l=Math.ceil(this._s.measureText(t,i)),a=xt(Math.round(l+2*n)),o=xt(this.M+2*n),u=Ms(document,new ws(a,o));s={Zs:i,ko:Math.round(Math.max(1,l)),Ss:Math.ceil(a*e),Ms:Math.ceil(o*e),xo:u},0!==l&&(this.ls.push(s.Zs),this.Mo.set(s.Zs,s)),B(t=bs(s.xo),e,(()=>{t.font=this.vs,t.fillStyle=this.bo,t.fillText(i,0,o-n-r)}))}return s}}class Vs{constructor(t,i,s,e){this.wt=null,this.Co=null,this.To=!1,this.Po=new Bt(50),this.Do=new Is(11,"#000"),this.bo=null,this.vs=null,this.Oo=0,this.Eo=!1,this.No=()=>{this.Ro(this.sl.options()),this.Eo||this.xt.Lo().Ao().lightUpdate()},this.Io=()=>{this.Eo||this.xt.Lo().Ao().lightUpdate()},this.xt=t,this.Lt=i,this.sl=s,this.Vo="left"===e,this.Bo=document.createElement("div"),this.Bo.style.height="100%",this.Bo.style.overflow="hidden",this.Bo.style.width="25px",this.Bo.style.left="0",this.Bo.style.position="relative",this.Fo=Ss(this.Bo,new ws(16,16)),this.Fo.subscribeCanvasConfigured(this.No);const n=this.Fo.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.zo=Ss(this.Bo,new ws(16,16)),this.zo.subscribeCanvasConfigured(this.Io);const h=this.zo.canvas;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0";const r={$a:this.Wo.bind(this),Wa:this.Wo.bind(this),Ra:this.jo.bind(this),Ea:this.jo.bind(this),Ha:this.$o.bind(this),Va:this.Ho.bind(this),La:this.Ho.bind(this),ma:this.Uo.bind(this),da:this.Uo.bind(this),ka:this.qo.bind(this),Qa:this.Yo.bind(this)};this.Xo=new Os(this.zo.canvas,r,{Da:()=>!1,Oa:()=>!0})}destroy(){this.Xo.destroy(),this.zo.unsubscribeCanvasConfigured(this.Io),this.zo.destroy(),this.Fo.unsubscribeCanvasConfigured(this.No),this.Fo.destroy(),null!==this.wt&&this.wt.onMarksChanged().unsubscribeAll(this),this.wt=null,this.Do.destroy()}Ko(){return this.Bo}V(){return r(this.wt).options().borderColor}Zo(){return this.Lt.textColor}Go(){return this.Lt.fontSize}Jo(){return T(this.Go(),this.Lt.fontFamily)}Qo(){const t=this.sl.options(),i=this.bo!==t.color,s=this.vs!==t.font;return(i||s)&&(this.Ro(t),this.bo=t.color),s&&(this.Po.reset(),this.vs=t.font),t}tu(){if(null===this.wt)return 0;let t=0;const i=this.Qo(),s=bs(this.Fo.canvas),e=this.wt.marks();s.font=this.Jo(),e.length>0&&(t=Math.max(this.Po.measureText(s,e[0].label),this.Po.measureText(s,e[e.length-1].label)));const n=this.iu();for(let i=n.length;i--;){const e=this.Po.measureText(s,n[i].text());e>t&&(t=e)}const h=this.wt.firstValue();if(null!==h&&null!==this.Co){const i=this.wt.coordinateToPrice(1,h),e=this.wt.coordinateToPrice(this.Co.J-2,h);t=Math.max(t,this.Po.measureText(s,this.wt.formatPrice(Math.floor(Math.min(i,e))+.11111111111111,h)),this.Po.measureText(s,this.wt.formatPrice(Math.ceil(Math.max(i,e))-.11111111111111,h)))}const r=t||34;let l=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+r);return l+=l%2,l}su(t){if(t.G<0||t.J<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Co&&this.Co.dl(t)||(this.Co=t,this.Eo=!0,this.Fo.resizeCanvas({width:t.G,height:t.J}),this.zo.resizeCanvas({width:t.G,height:t.J}),this.Eo=!1,this.Bo.style.width=t.G+"px",this.Bo.style.height=t.J+"px",this.Bo.style.minWidth=t.G+"px")}eu(){return r(this.Co).G}nu(t){this.wt!==t&&(null!==this.wt&&this.wt.onMarksChanged().unsubscribeAll(this),this.wt=t,t.onMarksChanged().subscribe(this.Nn.bind(this),this))}hu(){return this.wt}ru(){const t=this.xt.lu();this.xt.Lo().Ao().resetPriceScale(t,r(this.hu()))}au(t){if(null===this.Co)return;if(1!==t){const t=bs(this.Fo.canvas);this.ou(),this.uu(t,this.Fo.pixelRatio),this.Ui(t,this.Fo.pixelRatio),this.cu(t,this.Fo.pixelRatio),this._u(t,this.Fo.pixelRatio)}const i=bs(this.zo.canvas),s=this.Co.G,e=this.Co.J;B(i,this.zo.pixelRatio,(()=>{i.clearRect(0,0,s,e)})),this.du(i,this.zo.pixelRatio)}fu(){return this.Fo.canvas}rt(){var t;null===(t=this.wt)||void 0===t||t.marks()}Wo(t){if(null===this.wt||this.wt.isEmpty()||!this.xt.Lo().pu().handleScale.axisPressedMouseMove.price)return;const i=this.xt.Lo().Ao(),s=this.xt.lu();this.To=!0,i.startScalePrice(s,this.wt,t.oo)}jo(t){if(null===this.wt||!this.xt.Lo().pu().handleScale.axisPressedMouseMove.price)return;const i=this.xt.Lo().Ao(),s=this.xt.lu(),e=this.wt;i.scalePriceTo(s,e,t.oo)}$o(){if(null===this.wt||!this.xt.Lo().pu().handleScale.axisPressedMouseMove.price)return;const t=this.xt.Lo().Ao(),i=this.xt.lu(),s=this.wt;this.To&&(this.To=!1,t.endScalePrice(i,s))}Ho(t){if(null===this.wt||!this.xt.Lo().pu().handleScale.axisPressedMouseMove.price)return;const i=this.xt.Lo().Ao(),s=this.xt.lu();this.To=!1,i.endScalePrice(s,this.wt)}Uo(t){this.xt.Lo().pu().handleScale.axisDoubleClickReset&&this.ru()}qo(t){if(null===this.wt)return;!this.xt.Lo().Ao().options().handleScale.axisPressedMouseMove.price||this.wt.isPercentage()||this.wt.isIndexedTo100()||this.vu(1)}Yo(t){this.vu(0)}iu(){const t=[],i=null===this.wt?void 0:this.wt;return(s=>{for(let e=0;e<s.length;++e){const n=s[e].priceAxisViews(this.xt.lu(),i);for(let i=0;i<n.length;i++)t.push(n[i])}})(this.xt.lu().orderedSources()),t}uu(t,i){if(null===this.Co)return;const s=this.Co.G,e=this.Co.J;B(t,i,(()=>{const i=this.xt.lu().model(),n=i.backgroundTopColor(),h=i.backgroundBottomColor();n===h?F(t,0,0,s,e,n):z(t,0,0,s,e,n,h)}))}Ui(t,i){if(null===this.Co||null===this.wt||!this.wt.options().borderVisible)return;t.save(),t.fillStyle=this.V();const s=Math.max(1,Math.floor(this.Qo().borderSize*i));let e;e=this.Vo?Math.floor(this.Co.G*i)-s:0,t.fillRect(e,0,s,Math.ceil(this.Co.J*i)),t.restore()}cu(t,i){if(null===this.Co||null===this.wt)return;const s=this.wt.marks();t.save(),t.strokeStyle=this.V(),t.font=this.Jo(),t.fillStyle=this.V();const e=this.Qo(),n=this.Vo?Math.floor((this.Co.G-e.tickLength)*i-e.borderSize*i):Math.floor(e.borderSize*i),h=this.Vo?Math.round(n-e.paddingInner*i):Math.round(n+e.tickLength*i+e.paddingInner*i),r=this.Vo?"right":"left",l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=this.wt.options();if(o.borderVisible&&o.ticksVisible){const h=Math.round(e.tickLength*i);t.beginPath();for(const e of s)t.rect(n,Math.round(e.coord*i)-a,h,l);t.fill()}t.fillStyle=this.Zo();for(const e of s)this.Do.So(t,e.label,h,Math.round(e.coord*i),r);t.restore()}ou(){if(null===this.Co||null===this.wt)return;let t=this.Co.J/2;const i=[],s=this.wt.orderedSources().slice(),e=this.xt.lu(),n=this.Qo();this.wt===e.defaultVisiblePriceScale()&&this.xt.lu().orderedSources().forEach((t=>{e.isOverlay(t)&&s.push(t)}));const h=this.wt.dataSources()[0],r=this.wt;s.forEach((s=>{const n=s.priceAxisViews(e,r);n.forEach((t=>{t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),h===s&&n.length>0&&(t=n[0].coordinate())}));const l=i.filter((i=>i.coordinate()<=t)),a=i.filter((i=>i.coordinate()>t));l.sort(((t,i)=>i.coordinate()-t.coordinate())),l.length&&a.length&&a.push(l[0]),a.sort(((t,i)=>t.coordinate()-i.coordinate())),i.forEach((t=>t.setFixedCoordinate(t.coordinate())));if(this.wt.options().alignLabels){for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],e=s.height(n,!1),h=i.coordinate(),r=s.getFixedCoordinate();h>r-e&&i.setFixedCoordinate(r-e)}for(let t=1;t<a.length;t++){const i=a[t],s=a[t-1],e=s.height(n,!0),h=i.coordinate(),r=s.getFixedCoordinate();h<r+e&&i.setFixedCoordinate(r+e)}}}_u(t,i){if(null===this.Co)return;t.save();const s=this.Co,e=this.iu(),n=this.Qo(),h=this.Vo?"right":"left";e.forEach((e=>{if(e.isAxisLabelVisible()){const l=e.renderer(r(this.wt));t.save(),l.draw(t,n,this.Po,s.G,h,i),t.restore()}})),t.restore()}du(t,i){if(null===this.Co||null===this.wt)return;t.save();const s=this.Co,e=this.xt.Lo().Ao(),n=[],h=this.xt.lu(),l=e.crosshairSource().priceAxisViews(h,this.wt);l.length&&n.push(l);const a=this.Qo(),o=this.Vo?"right":"left";n.forEach((e=>{e.forEach((e=>{t.save(),e.renderer(r(this.wt)).draw(t,a,this.Po,s.G,o,i),t.restore()}))})),t.restore()}vu(t){this.Bo.style.cursor=1===t?"ns-resize":"default"}Nn(){const t=this.tu();this.Oo<t&&this.xt.Lo().Ao().fullUpdate(),this.Oo=t}Ro(t){this.Do.destroy(),this.Do=new Is(t.fontSize,t.color,t.fontFamily)}}function Bs(t,i,s,e,n){t.drawBackground&&t.drawBackground(i,s,e,n)}function Fs(t,i,s,e,n){t.draw(i,s,e,n)}function zs(t,i){return t.paneViews(i)}function Ws(t,i){return t.labelPaneViews(i)}function js(t,i){return void 0!==t.topPaneViews?t.topPaneViews(i):[]}class $s{constructor(t,i){this.Co=new ws(0,0),this.mu=null,this.wu=null,this.gu=null,this.bu=!1,this.Mu=new m,this.Su=0,this.yu=!1,this.ku=null,this.xu=!1,this.Cu=null,this.Tu=null,this.Eo=!1,this.No=()=>{this.Eo||null===this.Pu||this.St().lightUpdate()},this.Io=()=>{this.Eo||null===this.Pu||this.St().lightUpdate()},this.Du=t,this.Pu=i,this.Pu.onDestroyed().subscribe(this.Ou.bind(this),this,!0),this.Eu=document.createElement("td"),this.Eu.style.padding="0",this.Eu.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Nu=document.createElement("td"),this.Nu.style.padding="0",this.Ru=document.createElement("td"),this.Ru.style.padding="0",this.Eu.appendChild(s),this.Fo=Ss(s,new ws(16,16)),this.Fo.subscribeCanvasConfigured(this.No);const e=this.Fo.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.zo=Ss(s,new ws(16,16)),this.zo.subscribeCanvasConfigured(this.Io);const n=this.zo.canvas;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0",this.Au=document.createElement("tr"),this.Au.appendChild(this.Nu),this.Au.appendChild(this.Eu),this.Au.appendChild(this.Ru),this.Lu(),this.Xo=new Os(this.zo.canvas,this,{Da:()=>null===this.ku&&!this.Du.pu().handleScroll.vertTouchDrag,Oa:()=>null===this.ku&&!this.Du.pu().handleScroll.horzTouchDrag})}destroy(){null!==this.mu&&this.mu.destroy(),null!==this.wu&&this.wu.destroy(),this.zo.unsubscribeCanvasConfigured(this.Io),this.zo.destroy(),this.Fo.unsubscribeCanvasConfigured(this.No),this.Fo.destroy(),null!==this.Pu&&this.Pu.onDestroyed().unsubscribeAll(this),this.Xo.destroy()}lu(){return r(this.Pu)}Iu(t){null!==this.Pu&&this.Pu.onDestroyed().unsubscribeAll(this),this.Pu=t,null!==this.Pu&&this.Pu.onDestroyed().subscribe($s.prototype.Ou.bind(this),this,!0),this.Lu()}Lo(){return this.Du}Ko(){return this.Au}Lu(){if(null!==this.Pu&&(this.Vu(),0!==this.St().serieses().length)){if(null!==this.mu){const t=this.Pu.leftPriceScale();this.mu.nu(r(t))}if(null!==this.wu){const t=this.Pu.rightPriceScale();this.wu.nu(r(t))}}}Bu(){null!==this.mu&&this.mu.rt(),null!==this.wu&&this.wu.rt()}Fu(){return null!==this.Pu?this.Pu.stretchFactor():0}zu(t){this.Pu&&this.Pu.setStretchFactor(t)}ka(t){if(!this.Pu)return;this.Wu();const i=t.ao,s=t.oo;this.ju(i,s)}$a(t){this.Wu(),this.$u(),this.ju(t.ao,t.oo)}xa(t){if(!this.Pu)return;this.Wu();const i=t.ao,s=t.oo;this.ju(i,s);const e=this.Hu(i,s);this.St().setHoveredSource(e&&{source:e.Uu,object:e.qu})}Ba(t){null!==this.Pu&&(this.Wu(),this.Yu(t))}Ra(t){this.Wu(),this.Xu(t),this.ju(t.ao,t.oo)}Va(t){null!==this.Pu&&(this.Wu(),this.yu=!1,this.Ku(t))}Ia(t){null!==this.Pu&&this.Yu(t)}io(t){if(this.yu=!0,null===this.ku){const i={x:t.ao,y:t.oo};this.Zu(i,i)}}Qa(t){null!==this.Pu&&(this.Wu(),this.Pu.model().setHoveredSource(null),this.Gu())}Ju(){return this.Mu}Ya(){this.Su=1,this.Qu()}Xa(t,i){if(!this.Du.pu().handleScale.pinch)return;const s=5*(i-this.Su);this.Su=i,this.St().zoomTime(t.K,s)}Wa(t){if(this.yu=!1,this.xu=null!==this.ku,this.$u(),null!==this.ku){const i=this.St().crosshairSource();this.Cu={x:i.appliedX(),y:i.appliedY()},this.ku={x:t.ao,y:t.oo}}}Ea(t){if(null===this.Pu)return;const i=t.ao,s=t.oo;if(null===this.ku)this.Xu(t);else{this.xu=!1;const t=r(this.Cu),e=t.x+(i-this.ku.x),n=t.y+(s-this.ku.y);this.ju(e,n)}}La(t){0===this.Lo().pu().trackingMode.exitMode&&(this.xu=!0),this.tc(),this.Ku(t)}Hu(t,i){const s=this.Pu;if(null===s)return null;const e=s.orderedSources();for(const n of e){const e=this.ic(n.paneViews(s),t,i);if(null!==e)return{Uu:n,mo:e.mo,qu:e.qu}}return null}sc(t,i){r("left"===i?this.mu:this.wu).su(new ws(t,this.Co.J))}ec(){return this.Co}su(t){if(t.G<0||t.J<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Co.dl(t)||(this.Co=t,this.Eo=!0,this.Fo.resizeCanvas({width:t.G,height:t.J}),this.zo.resizeCanvas({width:t.G,height:t.J}),this.Eo=!1,this.Eu.style.width=t.G+"px",this.Eu.style.height=t.J+"px")}nc(){const t=r(this.Pu);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(const i of t.dataSources())if(t.isOverlay(i)){const s=i.priceScale();null!==s&&t.recalculatePriceScale(s),i.updateAllViews()}}fu(){return this.Fo.canvas}au(t){if(0===t)return;if(null===this.Pu)return;if(t>1&&this.nc(),null!==this.mu&&this.mu.au(t),null!==this.wu&&this.wu.au(t),1!==t){const t=bs(this.Fo.canvas);t.save(),this.uu(t,this.Fo.pixelRatio),this.Pu&&(this.hc(t,this.Fo.pixelRatio),this.rc(t,this.Fo.pixelRatio),this.lc(t,this.Fo.pixelRatio,zs),this.lc(t,this.Fo.pixelRatio,Ws)),t.restore()}const i=bs(this.zo.canvas);i.clearRect(0,0,Math.ceil(this.Co.G*this.zo.pixelRatio),Math.ceil(this.Co.J*this.zo.pixelRatio)),this.lc(i,this.Fo.pixelRatio,js),this.ac(i,this.zo.pixelRatio)}oc(){return this.mu}uc(){return this.wu}Ou(){null!==this.Pu&&this.Pu.onDestroyed().unsubscribeAll(this),this.Pu=null}Yu(t){const i=t.ao,s=t.oo;this.Mu.p()&&this.Mu._(this.St().timeScale().coordinateToIndex(i),{x:i,y:s})}uu(t,i){B(t,i,(()=>{const i=this.St(),s=i.backgroundTopColor(),e=i.backgroundBottomColor();s===e?F(t,0,0,this.Co.G,this.Co.J,e):z(t,0,0,this.Co.G,this.Co.J,s,e)}))}hc(t,i){const s=r(this.Pu),e=s.grid().paneView().renderer(s.height(),s.width());null!==e&&(t.save(),e.draw(t,i,!1),t.restore())}rc(t,i){const s=this.St().watermarkSource();this.cc(t,i,zs,Bs,s),this.cc(t,i,zs,Fs,s)}ac(t,i){this.cc(t,i,zs,Fs,this.St().crosshairSource())}lc(t,i,s){const e=r(this.Pu).orderedSources();for(const n of e)this.cc(t,i,s,Bs,n);for(const n of e)this.cc(t,i,s,Fs,n)}cc(t,i,s,e,n){const h=r(this.Pu),l=s(n,h),a=h.height(),o=h.width(),u=h.model().hoveredSource(),c=null!==u&&u.source===n,_=null!==u&&c&&void 0!==u.object?u.object.hitTestData:void 0;for(const s of l){const n=s.renderer(a,o);null!==n&&(t.save(),e(n,t,i,c,_),t.restore())}}ic(t,i,s){for(const e of t){const t=e.renderer(this.Co.J,this.Co.G);if(null!==t&&t.hitTest){const n=t.hitTest(i,s);if(null!==n)return{mo:e,qu:n}}}return null}Vu(){if(null===this.Pu)return;const t=this.Du,i=this.Pu.leftPriceScale().options().visible,s=this.Pu.rightPriceScale().options().visible;i||null===this.mu||(this.Nu.removeChild(this.mu.Ko()),this.mu.destroy(),this.mu=null),s||null===this.wu||(this.Ru.removeChild(this.wu.Ko()),this.wu.destroy(),this.wu=null);const e=t.Ao().rendererOptionsProvider();i&&null===this.mu&&(this.mu=new Vs(this,t.pu().layout,e,"left"),this.Nu.appendChild(this.mu.Ko())),s&&null===this.wu&&(this.wu=new Vs(this,t.pu().layout,e,"right"),this.Ru.appendChild(this.wu.Ko()))}_c(t){return t.fo&&this.yu||null!==this.ku}dc(t){return Math.max(0,Math.min(t,this.Co.G-1))}fc(t){return Math.max(0,Math.min(t,this.Co.J-1))}ju(t,i){this.St().setAndSaveCurrentPosition(this.dc(t),this.fc(i),r(this.Pu))}Gu(){this.St().clearCurrentPosition()}tc(){this.xu&&(this.ku=null,this.Gu())}Zu(t,i){this.ku=t,this.xu=!1,this.ju(i.x,i.y);const s=this.St().crosshairSource();this.Cu={x:s.appliedX(),y:s.appliedY()}}St(){return this.Du.Ao()}vc(){const t=this.St(),i=this.lu(),s=i.defaultPriceScale();t.endScrollPrice(i,s),t.endScrollTime(),this.gu=null,this.bu=!1}Ku(t){if(!this.bu)return;const i=performance.now();if(null!==this.Tu&&this.Tu.Es(t.ao,i),null===this.Tu||this.Tu.Pl(i))return void this.vc();const s=this.St(),e=s.timeScale(),n=this.Tu,h=()=>{if(n.Ol())return;const t=performance.now();let i=n.Pl(t);if(!n.Ol()){const h=e.rightOffset();s.scrollTimeTo(n.Tl(t)),h===e.rightOffset()&&(i=!0,this.Tu=null)}i?this.vc():requestAnimationFrame(h)};requestAnimationFrame(h)}Wu(){this.ku=null}$u(){if(!this.Pu)return;if(this.Qu(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)r(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Pu.defaultPriceScale().isEmpty()&&this.St().timeScale().isEmpty()}Xu(t){if(null===this.Pu)return;const i=this.St();if(i.timeScale().isEmpty())return;const s=this.Du.pu(),e=s.handleScroll,n=s.kineticScroll;if((!e.pressedMouseMove||t.fo)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.fo))return;const h=this.Pu.defaultPriceScale(),r=performance.now();null!==this.gu||this._c(t)||(this.gu={x:t.so,y:t.eo,mc:r,ao:t.ao,oo:t.oo}),null!==this.Tu&&this.Tu.Cl(t.ao,r),null===this.gu||this.bu||this.gu.x===t.so&&this.gu.y===t.eo||(null===this.Tu&&(t.fo&&n.touch||!t.fo&&n.mouse)&&(this.Tu=new xs(.2,7,.997,15),this.Tu.Cl(this.gu.ao,this.gu.mc),this.Tu.Cl(t.ao,r)),h.isEmpty()||i.startScrollPrice(this.Pu,h,t.oo),i.startScrollTime(t.ao),this.bu=!0),this.bu&&(h.isEmpty()||i.scrollPriceTo(this.Pu,h,t.oo),i.scrollTimeTo(t.ao))}Qu(){const t=performance.now(),i=null===this.Tu||this.Tu.Pl(t);null!==this.Tu&&(i||this.vc()),null!==this.Tu&&(this.Tu.El(),this.Tu=null)}}class Hs{constructor(t,i,s,e,n){this.j=!0,this.Co=new ws(0,0),this.No=()=>this.au(3),this.Vo="left"===t,this.sl=s.wc,this.Lt=i,this.gc=e,this.bc=n,this.Bo=document.createElement("div"),this.Bo.style.width="25px",this.Bo.style.height="100%",this.Bo.style.overflow="hidden",this.Fo=Ss(this.Bo,new ws(16,16)),this.Fo.subscribeCanvasConfigured(this.No)}destroy(){this.Fo.unsubscribeCanvasConfigured(this.No),this.Fo.destroy()}Ko(){return this.Bo}ec(){return this.Co}su(t){if(t.G<0||t.J<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Co.dl(t)||(this.Co=t,this.Fo.resizeCanvas({width:t.G,height:t.J}),this.Bo.style.width=`${t.G}px`,this.Bo.style.minWidth=`${t.G}px`,this.Bo.style.height=`${t.J}px`,this.j=!0)}au(t){if(t<3&&!this.j)return;if(0===this.Co.G||0===this.Co.J)return;this.j=!1;const i=bs(this.Fo.canvas);this.uu(i,this.Fo.pixelRatio),this.Ui(i,this.Fo.pixelRatio)}fu(){return this.Fo.canvas}Ui(t,i){if(!this.gc())return;const s=this.Co.G;t.save(),t.fillStyle=this.Lt.timeScale.borderColor;const e=Math.floor(this.sl.options().borderSize*i),n=this.Vo?Math.round(s*i)-e:0;t.fillRect(n,0,e,e),t.restore()}uu(t,i){B(t,i,(()=>{F(t,0,0,this.Co.G,this.Co.J,this.bc())}))}}function Us(t,i){return t.weight>i.weight?t:i}class qs{constructor(t){this.Mc=null,this.Sc=null,this.m=null,this.yc=!1,this.Co=new ws(0,0),this.kc=new m,this.Po=new Bt(5),this.Eo=!1,this.No=()=>{this.Eo||this.Du.Ao().lightUpdate()},this.Io=()=>{this.Eo||this.Du.Ao().lightUpdate()},this.Du=t,this.Lt=t.pu().layout,this.xc=document.createElement("tr"),this.Cc=document.createElement("td"),this.Cc.style.padding="0",this.Tc=document.createElement("td"),this.Tc.style.padding="0",this.Bo=document.createElement("td"),this.Bo.style.height="25px",this.Bo.style.padding="0",this.Pc=document.createElement("div"),this.Pc.style.width="100%",this.Pc.style.height="100%",this.Pc.style.position="relative",this.Pc.style.overflow="hidden",this.Bo.appendChild(this.Pc),this.Fo=Ss(this.Pc,new ws(16,16)),this.Fo.subscribeCanvasConfigured(this.No);const i=this.Fo.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.zo=Ss(this.Pc,new ws(16,16)),this.zo.subscribeCanvasConfigured(this.Io);const s=this.zo.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.xc.appendChild(this.Cc),this.xc.appendChild(this.Bo),this.xc.appendChild(this.Tc),this.Dc(),this.Du.Ao().priceScalesOptionsChanged().subscribe(this.Dc.bind(this),this),this.Xo=new Os(this.zo.canvas,this,{Da:()=>!0,Oa:()=>!1})}destroy(){this.Xo.destroy(),null!==this.Mc&&this.Mc.destroy(),null!==this.Sc&&this.Sc.destroy(),this.zo.unsubscribeCanvasConfigured(this.Io),this.zo.destroy(),this.Fo.unsubscribeCanvasConfigured(this.No),this.Fo.destroy()}Ko(){return this.xc}Oc(){return this.Mc}Ec(){return this.Sc}$a(t){if(this.yc)return;this.yc=!0;const i=this.Du.Ao();!i.timeScale().isEmpty()&&this.Du.pu().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.ao)}Wa(t){this.$a(t)}Ha(){const t=this.Du.Ao();!t.timeScale().isEmpty()&&this.yc&&(this.yc=!1,this.Du.pu().handleScale.axisPressedMouseMove.time&&t.endScaleTime())}Ra(t){const i=this.Du.Ao();!i.timeScale().isEmpty()&&this.Du.pu().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.ao)}Ea(t){this.Ra(t)}Va(){this.yc=!1;const t=this.Du.Ao();t.timeScale().isEmpty()&&!this.Du.pu().handleScale.axisPressedMouseMove.time||t.endScaleTime()}La(){this.Va()}ma(){this.Du.pu().handleScale.axisDoubleClickReset&&this.Du.Ao().resetTimeScale()}da(){this.ma()}ka(){this.Du.Ao().options().handleScale.axisPressedMouseMove.time&&this.vu(1)}Qa(){this.vu(0)}ec(){return this.Co}Nc(){return this.kc}Rc(t,i,s){this.Co&&this.Co.dl(t)||(this.Co=t,this.Eo=!0,this.Fo.resizeCanvas({width:t.G,height:t.J}),this.zo.resizeCanvas({width:t.G,height:t.J}),this.Eo=!1,this.Bo.style.width=t.G+"px",this.Bo.style.height=t.J+"px",this.kc._(t)),null!==this.Mc&&this.Mc.su(new ws(i,t.J)),null!==this.Sc&&this.Sc.su(new ws(s,t.J))}Ac(){const t=this.Lc();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)}rt(){this.Du.Ao().timeScale().marks()}fu(){return this.Fo.canvas}au(t){if(0===t)return;if(1!==t){const i=bs(this.Fo.canvas);this.uu(i,this.Fo.pixelRatio),this.Ui(i,this.Fo.pixelRatio),this.cu(i,this.Fo.pixelRatio),null!==this.Mc&&this.Mc.au(t),null!==this.Sc&&this.Sc.au(t)}const i=bs(this.zo.canvas),s=this.zo.pixelRatio;i.clearRect(0,0,Math.ceil(this.Co.G*s),Math.ceil(this.Co.J*s)),this.Ic([this.Du.Ao().crosshairSource()],i,s)}uu(t,i){B(t,i,(()=>{F(t,0,0,this.Co.G,this.Co.J,this.Du.Ao().backgroundBottomColor())}))}Ui(t,i){if(this.Du.pu().timeScale.borderVisible){t.save(),t.fillStyle=this.Vc();const s=Math.max(1,Math.floor(this.Lc().borderSize*i));t.fillRect(0,0,Math.ceil(this.Co.G*i),s),t.restore()}}cu(t,i){const s=this.Du.Ao().timeScale(),e=s.marks();if(!e||0===e.length)return;let n=e.reduce(Us,e[0]).weight;n>30&&n<50&&(n=30),t.save(),t.strokeStyle=this.Vc();const h=this.Lc(),r=h.borderSize+h.tickLength+h.paddingTop+h.fontSize-h.baselineOffset;t.textAlign="center",t.fillStyle=this.Vc();const l=Math.floor(this.Lc().borderSize*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i),u=s.options();if(u.borderVisible&&u.ticksVisible){t.beginPath();const s=Math.round(h.tickLength*i);for(let n=e.length;n--;){const h=Math.round(e[n].coord*i);t.rect(h-o,l,a,s)}t.fill()}t.fillStyle=this.k(),B(t,i,(()=>{t.font=this.Bc();for(const i of e)if(i.weight<n){const s=i.needAlignCoordinate?this.Fc(t,i.coord,i.label):i.coord;t.fillText(i.label,s,r)}t.font=this.zc();for(const i of e)if(i.weight>=n){const s=i.needAlignCoordinate?this.Fc(t,i.coord,i.label):i.coord;t.fillText(i.label,s,r)}})),t.restore()}Fc(t,i,s){const e=this.Po.measureText(t,s),n=e/2,h=Math.floor(i-n)+.5;return h<0?i+=Math.abs(0-h):h+e>this.Co.G&&(i-=Math.abs(this.Co.G-(h+e))),i}Ic(t,i,s){const e=this.Lc();for(const n of t)for(const t of n.timeAxisViews())i.save(),t.renderer().draw(i,e,s),i.restore()}Vc(){return this.Du.pu().timeScale.borderColor}k(){return this.Lt.textColor}M(){return this.Lt.fontSize}Bc(){return T(this.M(),this.Lt.fontFamily)}zc(){return T(this.M(),this.Lt.fontFamily,"bold")}Lc(){null===this.m&&(this.m={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new Bt});const t=this.m,i=this.Bc();if(t.font!==i){const s=this.M();t.fontSize=s,t.font=i,t.paddingTop=Math.ceil(s/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(s/2),t.baselineOffset=Math.round(this.M()/5),t.widthCache.reset()}return this.m}vu(t){this.Bo.style.cursor=1===t?"ew-resize":"default"}Dc(){const t=this.Du.Ao(),i=t.options();i.leftPriceScale.visible||null===this.Mc||(this.Cc.removeChild(this.Mc.Ko()),this.Mc.destroy(),this.Mc=null),i.rightPriceScale.visible||null===this.Sc||(this.Tc.removeChild(this.Sc.Ko()),this.Sc.destroy(),this.Sc=null);const s={wc:this.Du.Ao().rendererOptionsProvider()},e=()=>i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible,n=()=>t.backgroundBottomColor();i.leftPriceScale.visible&&null===this.Mc&&(this.Mc=new Hs("left",i,s,e,n),this.Cc.appendChild(this.Mc.Ko())),i.rightPriceScale.visible&&null===this.Sc&&(this.Sc=new Hs("right",i,s,e,n),this.Tc.appendChild(this.Sc.Ko()))}}class Ys{constructor(t,i){var s;this.Wc=[],this.jc=0,this.kn=0,this.cs=0,this.$c=0,this.Hc=0,this.Uc=null,this.qc=!1,this.Mu=new m,this.Qr=new m,this.Lt=i,this.xc=document.createElement("div"),this.xc.classList.add("tv-lightweight-charts"),this.xc.style.overflow="hidden",this.xc.style.width="100%",this.xc.style.height="100%",(s=this.xc).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.Yc=document.createElement("table"),this.Yc.setAttribute("cellspacing","0"),this.xc.appendChild(this.Yc),this.Xc=this.Kc.bind(this),this.xc.addEventListener("wheel",this.Xc,{passive:!1}),this.St=new _s(this.il.bind(this),this.Lt),this.Ao().crosshairMoved().subscribe(this.Zc.bind(this),this),this.Gc=new qs(this),this.Yc.appendChild(this.Gc.Ko());let e=this.Lt.width,n=this.Lt.height;if(0===e||0===n){const i=t.getBoundingClientRect();0===e&&(e=Math.floor(i.width),e-=e%2),0===n&&(n=Math.floor(i.height),n-=n%2)}this.Jc(e,n),this.Qc(),t.appendChild(this.xc),this.t_(),this.St.timeScale().optionsApplied().subscribe(this.St.fullUpdate.bind(this.St),this),this.St.priceScalesOptionsChanged().subscribe(this.St.fullUpdate.bind(this.St),this)}Ao(){return this.St}pu(){return this.Lt}i_(){return this.Wc}s_(){return this.Gc}destroy(){this.xc.removeEventListener("wheel",this.Xc),0!==this.jc&&window.cancelAnimationFrame(this.jc),this.St.crosshairMoved().unsubscribeAll(this),this.St.timeScale().optionsApplied().unsubscribeAll(this),this.St.priceScalesOptionsChanged().unsubscribeAll(this),this.St.destroy();for(const t of this.Wc)this.Yc.removeChild(t.Ko()),t.Ju().unsubscribeAll(this),t.destroy();this.Wc=[],r(this.Gc).destroy(),null!==this.xc.parentElement&&this.xc.parentElement.removeChild(this.xc),this.Qr.v(),this.Mu.v()}Jc(t,i,s=!1){if(this.kn===i&&this.cs===t)return;this.kn=i,this.cs=t;const e=i+"px",n=t+"px";r(this.xc).style.height=e,r(this.xc).style.width=n,this.Yc.style.height=e,this.Yc.style.width=n,s?this.e_(new G(3)):this.St.fullUpdate()}au(t){void 0===t&&(t=new G(3));for(let i=0;i<this.Wc.length;i++)this.Wc[i].au(t.invalidateForPane(i).level);this.Lt.timeScale.visible&&this.Gc.au(t.fullInvalidation())}n_(t){this.St.applyOptions(t),this.t_();const i=t.width||this.cs,s=t.height||this.kn;this.Jc(i,s)}Ju(){return this.Mu}h_(){return this.Qr}r_(){null!==this.Uc&&(this.e_(this.Uc),this.Uc=null);const t=this.Wc[0],i=Ms(document,new ws(this.cs,this.kn)),s=bs(i),e=gs(i);return B(s,e,(()=>{let i=0,e=0;const n=t=>{for(let n=0;n<this.Wc.length;n++){const h=this.Wc[n],l=h.ec().J,a=r("left"===t?h.oc():h.uc()),o=a.fu();s.drawImage(o,i,e,a.eu(),l),e+=l}};this.l_()&&(n("left"),i=r(t.oc()).eu()),e=0;for(let t=0;t<this.Wc.length;t++){const n=this.Wc[t],h=n.ec(),r=n.fu();s.drawImage(r,i,e,h.G,h.J),e+=h.J}i+=t.ec().G,this.a_()&&(e=0,n("right"));const h=t=>{const n=r("left"===t?this.Gc.Oc():this.Gc.Ec()),h=n.ec(),l=n.fu();s.drawImage(l,i,e,h.G,h.J)};if(this.Lt.timeScale.visible){i=0,this.l_()&&(h("left"),i=r(t.oc()).eu());const n=this.Gc.ec(),l=this.Gc.fu();s.drawImage(l,i,e,n.G,n.J),this.a_()&&(i+=t.ec().G,h("right"),s.restore())}})),i}o_(t){if("left"===t&&!this.l_())return 0;if("right"===t&&!this.a_())return 0;if(0===this.Wc.length)return 0;return r("left"===t?this.Wc[0].oc():this.Wc[0].uc()).eu()}u_(){let t=0,i=0,s=0;for(const e of this.Wc)this.l_()&&(i=Math.max(i,r(e.oc()).tu())),this.a_()&&(s=Math.max(s,r(e.uc()).tu())),t+=e.Fu();const e=this.cs,n=this.kn,h=Math.max(e-i-s,0),l=this.Lt.timeScale.visible;let a=l?this.Gc.Ac():0;a%2&&(a+=1);const o=0+a,u=n<o?0:n-o,c=u/t;let _=0;for(let t=0;t<this.Wc.length;++t){const e=this.Wc[t];e.Iu(this.St.panes()[t]);let n=0,r=0;r=t===this.Wc.length-1?u-_:Math.round(e.Fu()*c),n=Math.max(r,2),_+=n,e.su(new ws(h,n)),this.l_()&&e.sc(i,"left"),this.a_()&&e.sc(s,"right"),e.lu()&&this.St.setPaneHeight(e.lu(),n)}this.Gc.Rc(new ws(l?h:0,a),l?i:0,l?s:0),this.St.setWidth(h),this.$c!==i&&(this.$c=i),this.Hc!==s&&(this.Hc=s)}Kc(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.Lt.handleScroll.mouseWheel||0!==s&&this.Lt.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.Lt.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),e=t.clientX-this.xc.getBoundingClientRect().left;this.Ao().zoomTime(e,i)}0!==i&&this.Lt.handleScroll.mouseWheel&&this.Ao().scrollChart(-80*i)}}e_(t){var i;const s=t.fullInvalidation();3===s&&this.c_(),3!==s&&2!==s||(this.__(t),this.d_(t),this.Gc.rt(),this.Wc.forEach((t=>{t.Bu()})),3===(null===(i=this.Uc)||void 0===i?void 0:i.fullInvalidation())&&(this.Uc.merge(t),this.c_(),this.__(this.Uc),this.d_(this.Uc),t=this.Uc,this.Uc=null)),this.au(t)}d_(t){const i=t.timeScaleInvalidations();for(const t of i)this.Xt(t)}__(t){const i=this.St.panes();for(let s=0;s<i.length;s++)t.invalidateForPane(s).autoScale&&i[s].momentaryAutoScale()}Xt(t){const i=this.St.timeScale();switch(t.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(t.value);break;case 2:i.setBarSpacing(t.value);break;case 3:i.setRightOffset(t.value);break;case 4:i.restoreDefault()}}il(t){null!==this.Uc?this.Uc.merge(t):this.Uc=t,this.qc||(this.qc=!0,this.jc=window.requestAnimationFrame((()=>{if(this.qc=!1,this.jc=0,null!==this.Uc){const t=this.Uc;this.Uc=null,this.e_(t)}})))}c_(){this.Qc()}Qc(){const t=this.St.panes(),i=t.length,s=this.Wc.length;for(let t=i;t<s;t++){const t=h(this.Wc.pop());this.Yc.removeChild(t.Ko()),t.Ju().unsubscribeAll(this),t.destroy()}for(let e=s;e<i;e++){const i=new $s(this,t[e]);i.Ju().subscribe(this.f_.bind(this),this),this.Wc.push(i),this.Yc.insertBefore(i.Ko(),this.Gc.Ko())}for(let s=0;s<i;s++){const i=t[s],e=this.Wc[s];e.lu()!==i?e.Iu(i):e.Lu()}this.t_(),this.u_()}p_(t,i){var s;const e=new Map;if(null!==t){this.St.serieses().forEach((i=>{const s=i.bars().search(t);null!==s&&e.set(i,s)}))}let n;if(null!==t){const i=null===(s=this.St.timeScale().indexToTimeScalePoint(t))||void 0===s?void 0:s.originalTime;void 0!==i&&(n=i)}const h=this.Ao().hoveredSource(),r=null!==h&&h.source instanceof yi?h.source:void 0,l=null!==h&&void 0!==h.object?h.object.externalId:void 0;return{yt:n,Wh:null!=t?t:void 0,v_:null!=i?i:void 0,m_:r,w_:e,g_:l}}f_(t,i){this.Mu._((()=>this.p_(t,i)))}Zc(t,i){this.Qr._((()=>this.p_(t,i)))}t_(){const t=this.Lt.timeScale.visible?"":"none";this.Gc.Ko().style.display=t}l_(){return this.Wc[0].lu().leftPriceScale().options().visible}a_(){return this.Wc[0].lu().rightPriceScale().options().visible}}function Xs(t,i,s,e){const n=s.value;return{index:i,time:t,value:[n,n,n,n],originalTime:e}}function Ks(t,i,s,e){const n=s.value,h={index:i,time:t,value:[n,n,n,n],originalTime:e};return"color"in s&&void 0!==s.color&&(h.color=s.color),h}function Zs(t){return void 0!==t.value}function Gs(t){return(i,s,e,n)=>{return void 0===(h=e).open&&void 0===h.value?{time:i,index:s,originalTime:n}:t(i,s,e,n);var h}}const Js={Candlestick:Gs((function(t,i,s,e){const n={index:i,time:t,value:[s.open,s.high,s.low,s.close],originalTime:e};return"color"in s&&void 0!==s.color&&(n.color=s.color),"borderColor"in s&&void 0!==s.borderColor&&(n.borderColor=s.borderColor),"wickColor"in s&&void 0!==s.wickColor&&(n.wickColor=s.wickColor),n})),Bar:Gs((function(t,i,s,e){const n={index:i,time:t,value:[s.open,s.high,s.low,s.close],originalTime:e};return"color"in s&&void 0!==s.color&&(n.color=s.color),n})),Area:Gs(Xs),Baseline:Gs(Xs),Histogram:Gs(Ks),Line:Gs(Ks)};function Qs(t){return Js[t]}function te(t){return 60*t*60*1e3}function ie(t){return 60*t*1e3}const se=[{b_:(ee=1,1e3*ee),jh:10},{b_:ie(1),jh:20},{b_:ie(5),jh:21},{b_:ie(30),jh:22},{b_:te(1),jh:30},{b_:te(3),jh:31},{b_:te(6),jh:32},{b_:te(12),jh:33}];var ee;function ne(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=se.length-1;s>=0;--s)if(Math.floor(i.getTime()/se[s].b_)!==Math.floor(t.getTime()/se[s].b_))return se[s].jh;return 0}function he(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].time.timestamp,e=null!==s?new Date(1e3*s):null,n=0;for(let h=i;h<t.length;++h){const i=t[h],r=new Date(1e3*i.time.timestamp);null!==e&&(i.timeWeight=ne(r,e)),n+=i.time.timestamp-(s||i.time.timestamp),s=i.time.timestamp,e=r}if(0===i&&t.length>1){const i=Math.ceil(n/(t.length-1)),s=new Date(1e3*(t[0].time.timestamp-i));t[0].timeWeight=ne(new Date(1e3*t[0].time.timestamp),s)}}function re(t){if(!fs(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function le(t){if(!ps(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function ae(t){return 0===t.length?null:fs(t[0].time)?re:le}function oe(t){return ps(t)?le(t):fs(t)?re(t):re(ue(t))}function ue(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ce(t){M(t.time)&&(t.time=ue(t.time))}function _e(t){return{Wh:0,M_:new Map,S_:t}}function de(t){if(void 0!==t&&0!==t.length)return{y_:t[0].time.timestamp,k_:t[t.length-1].time.timestamp}}function fe(t){let i;return t.forEach((t=>{void 0===i&&(i=t.originalTime)})),h(i)}function pe(t){void 0===t.$h&&(t.$h=t.time)}class ve{constructor(){this.x_=new Map,this.C_=new Map,this.T_=new Map,this.P_=[]}v(){this.x_.clear(),this.C_.clear(),this.T_.clear(),this.P_=[]}D_(t,i){let s=0!==this.x_.size,e=!1;const n=this.C_.get(t);if(void 0!==n)if(1===this.C_.size)s=!1,e=!0,this.x_.clear();else for(const i of this.P_)i.pointData.M_.delete(t)&&(e=!0);let h=[];if(0!==i.length){const s=i;s.forEach((t=>pe(t))),function(t){t.forEach(ce)}(i);const n=r(ae(i)),l=Qs(t.seriesType());h=s.map((i=>{const s=n(i.time);let h=this.x_.get(s.timestamp);void 0===h&&(h=_e(s),this.x_.set(s.timestamp,h),e=!0);const r=l(s,h.Wh,i,i.$h);return h.M_.set(t,r),r}))}s&&this.O_(),this.E_(t,h);let l=-1;if(e){const t=[];this.x_.forEach((i=>{t.push({timeWeight:0,time:i.S_,pointData:i,originalTime:fe(i.M_)})})),t.sort(((t,i)=>t.time.timestamp-i.time.timestamp)),l=this.N_(t)}return this.R_(t,l,function(t,i){const s=de(t),e=de(i);if(void 0!==s&&void 0!==e)return{lastBarUpdatedOrNewBarsAddedToTheRight:s.k_>=e.k_&&s.y_>=e.y_}}(this.C_.get(t),n))}A_(t){return this.D_(t,[])}L_(t,i){const s=i;pe(s),ce(i);const e=r(ae([i]))(i.time),n=this.T_.get(t);if(void 0!==n&&e.timestamp<n.timestamp)throw new Error(`Cannot update oldest data, last time=${n.timestamp}, new time=${e.timestamp}`);let h=this.x_.get(e.timestamp);const l=void 0===h;void 0===h&&(h=_e(e),this.x_.set(e.timestamp,h));const a=Qs(t.seriesType())(e,h.Wh,i,s.$h);h.M_.set(t,a),this.I_(t,a);const o={lastBarUpdatedOrNewBarsAddedToTheRight:Zs(a)};if(!l)return this.R_(t,-1,o);const u={timeWeight:0,time:h.S_,pointData:h,originalTime:fe(h.M_)},c=ct(this.P_,u.time.timestamp,((t,i)=>t.time.timestamp<i));this.P_.splice(c,0,u);for(let t=c;t<this.P_.length;++t)me(this.P_[t].pointData,t);return he(this.P_,c),this.R_(t,c,o)}I_(t,i){let s=this.C_.get(t);void 0===s&&(s=[],this.C_.set(t,s));const e=0!==s.length?s[s.length-1]:null;null===e||i.time.timestamp>e.time.timestamp?Zs(i)&&s.push(i):Zs(i)?s[s.length-1]=i:s.splice(-1,1),this.T_.set(t,i.time)}E_(t,i){0!==i.length?(this.C_.set(t,i.filter(Zs)),this.T_.set(t,i[i.length-1].time)):(this.C_.delete(t),this.T_.delete(t))}O_(){for(const t of this.P_)0===t.pointData.M_.size&&this.x_.delete(t.time.timestamp)}N_(t){let i=-1;for(let s=0;s<this.P_.length&&s<t.length;++s){const e=this.P_[s],n=t[s];if(e.time.timestamp!==n.time.timestamp){i=s;break}n.timeWeight=e.timeWeight,me(n.pointData,s)}if(-1===i&&this.P_.length!==t.length&&(i=Math.min(this.P_.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)me(t[s].pointData,s);return he(t,i),this.P_=t,i}V_(){if(0===this.C_.size)return null;let t=0;return this.C_.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t}R_(t,i,s){const e={B_:new Map,F_:{z_:this.V_()}};if(-1!==i)this.C_.forEach(((i,n)=>{e.B_.set(n,{Cs:i,W_:n===t?s:void 0})})),this.C_.has(t)||e.B_.set(t,{Cs:[],W_:s}),e.F_.j_=this.P_,e.F_.H_=i;else{const i=this.C_.get(t);e.B_.set(t,{Cs:i||[],W_:s})}return e}}function me(t,i){t.Wh=i,t.M_.forEach((t=>{t.index=i}))}function we(t){return{value:t.value[3],time:t.originalTime}}function ge(t){const i=we(t);return void 0!==t.color&&(i.color=t.color),i}function be(t){return{open:t.value[0],high:t.value[1],low:t.value[2],close:t.value[3],time:t.originalTime}}const Me={Area:we,Line:ge,Baseline:we,Histogram:ge,Bar:function(t){const i=be(t);return void 0!==t.color&&(i.color=t.color),i},Candlestick:function(t){const i=be(t),{color:s,borderColor:e,wickColor:n}=t;return void 0!==s&&(i.color=s),void 0!==e&&(i.borderColor=e),void 0!==n&&(i.wickColor=n),i}};function Se(t){return Me[t]}const ye={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class ke{constructor(t){this._e=t}applyOptions(t){this._e.applyOptions(t)}options(){return this._e.options()}U_(){return this._e}}class xe{constructor(t,i,s){this.pi=t,this.q_=i,this.Y_=s}setDrawingPane(t){this.pi.setDrawingPane(t)}priceFormatter(){return this.pi.formatter()}priceToCoordinate(t){const i=this.pi.firstValue();return null===i?null:this.pi.priceScale().priceToCoordinate(t,i.value)}coordinateToPrice(t){const i=this.pi.firstValue();return null===i?null:this.pi.priceScale().coordinateToPrice(t,i.value)}barsInLogicalRange(t){if(null===t)return null;const i=new ss(new Qi(t.from,t.to)).Xh(),s=this.pi.bars();if(s.isEmpty())return null;const e=s.search(i.left(),1),n=s.search(i.right(),-1),h=r(s.firstIndex()),l=r(s.lastIndex());if(null!==e&&null!==n&&e.index>n.index)return{barsBefore:t.from-h,barsAfter:l-t.to};const a={barsBefore:null===e||e.index===h?t.from-h:e.index-h,barsAfter:null===n||n.index===l?l-t.to:l-n.index};return null!==e&&null!==n&&(a.from=e.time.businessDay||e.time.timestamp,a.to=n.time.businessDay||n.time.timestamp),a}setData(t){this.pi.seriesType(),this.q_.X_(this.pi,t)}update(t){this.pi.seriesType(),this.q_.K_(this.pi,t)}dataByIndex(t,i){const s=this.pi.bars().search(t,i);return null===s?null:Se(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:oe(t.time)})));this.pi.setMarkers(i)}markers(){return this.pi.markers().map((t=>{const{originalTime:i,time:s}=t,e=function(t,i){var s={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.indexOf(e)<0&&(s[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(e=Object.getOwnPropertySymbols(t);n<e.length;n++)i.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(s[e[n]]=t[e[n]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},e)}))}applyOptions(t){this.pi.applyOptions(t)}options(){return y(this.pi.options())}priceScale(){return this.Y_.priceScale(this.pi.priceScale().id())}createPriceLine(t){const i=w(y(ye),t),s=this.pi.createPriceLine(i);return new ke(s)}removePriceLine(t){this.pi.removePriceLine(t.U_())}seriesType(){return this.pi.seriesType()}}class Ce extends xe{applyOptions(t){ds(t),super.applyOptions(t)}}const Te={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!0,scaleMargins:{bottom:.1,top:.2}},Pe={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:C,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},De={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:C},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Te),leftPriceScale:Object.assign(Object.assign({},Te),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Te),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!0},watermark:Pe,localization:{locale:Cs?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Oe={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Ee={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Ne={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Re={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ae={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Le={color:"#26a69a",base:0},Ie={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Ve{constructor(t,i){this.Z_=t,this.G_=i}applyOptions(t){this.Z_.Ao().applyPriceScaleOptions(this.G_,t)}options(){return this.wt().options()}width(){return Z(this.G_)?this.Z_.o_(this.G_):0}wt(){return r(this.Z_.Ao().findPriceScale(this.G_)).priceScale}}class Be{constructor(t,i){this.J_=new m,this.nr=new m,this.kc=new m,this.St=t,this.nh=t.timeScale(),this.Gc=i,this.nh.visibleBarsChanged().subscribe(this.Q_.bind(this)),this.nh.logicalRangeChanged().subscribe(this.td.bind(this)),this.Gc.Nc().subscribe(this.sd.bind(this))}destroy(){this.nh.visibleBarsChanged().unsubscribeAll(this),this.nh.logicalRangeChanged().unsubscribeAll(this),this.Gc.Nc().unsubscribeAll(this),this.J_.v(),this.nr.v(),this.kc.v()}scrollPosition(){return this.nh.rightOffset()}scrollToPosition(t,i){i?this.nh.scrollToOffsetAnimated(t,1e3):this.St.setRightOffset(t)}scrollToRealTime(){this.nh.scrollToRealTime()}getVisibleRange(){var t,i;const s=this.nh.visibleTimeRange();return null===s?null:{from:null!==(t=s.from.businessDay)&&void 0!==t?t:s.from.timestamp,to:null!==(i=s.to.businessDay)&&void 0!==i?i:s.to.timestamp}}setVisibleRange(t){const i={from:oe(t.from),to:oe(t.to)},s=this.nh.logicalRangeForTimeRange(i);this.St.setTargetLogicalRange(s)}getVisibleLogicalRange(){const t=this.nh.visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}}setVisibleLogicalRange(t){n(t.from<=t.to,"The from index cannot be after the to index."),this.St.setTargetLogicalRange(t)}resetTimeScale(){this.St.resetTimeScale()}fitContent(){this.St.fitContent()}logicalToCoordinate(t){const i=this.St.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)}coordinateToLogical(t){return this.nh.isEmpty()?null:this.nh.coordinateToIndex(t)}timeToCoordinate(t){const i=oe(t),s=this.nh.timeToIndex(i,!1);return null===s?null:this.nh.indexToCoordinate(s)}coordinateToTime(t){var i;const s=this.St.timeScale(),e=s.coordinateToIndex(t),n=s.indexToTime(e);return null===n?null:null!==(i=n.businessDay)&&void 0!==i?i:n.timestamp}width(){return this.Gc.ec().G}height(){return this.Gc.ec().J}subscribeVisibleTimeRangeChange(t){this.J_.subscribe(t)}unsubscribeVisibleTimeRangeChange(t){this.J_.unsubscribe(t)}subscribeVisibleLogicalRangeChange(t){this.nr.subscribe(t)}unsubscribeVisibleLogicalRangeChange(t){this.nr.unsubscribe(t)}subscribeSizeChange(t){this.kc.subscribe(t)}unsubscribeSizeChange(t){this.kc.unsubscribe(t)}applyOptions(t){this.nh.applyOptions(t)}options(){return y(this.nh.options())}Q_(){this.J_.p()&&this.J_._(this.getVisibleRange())}td(){this.nr.p()&&this.nr._(this.getVisibleLogicalRange())}sd(t){this.kc._(t.G,t.J)}}function Fe(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function ze(t){return function(t){if(S(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&S(t.handleScale.axisPressedMouseMove)){const i=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:i,price:i}}const i=t.handleScroll;S(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class We{constructor(t,i){this.ed=new ve,this.nd=new Map,this.hd=new Map,this.rd=new m,this.ld=new m;const s=void 0===i?y(De):w(y(De),ze(i));this.Z_=new Ys(t,s),this.Z_.Ju().subscribe((t=>{this.rd.p()&&this.rd._(this.ad(t()))}),this),this.Z_.h_().subscribe((t=>{this.ld.p()&&this.ld._(this.ad(t()))}),this);const e=this.Z_.Ao();this.od=new Be(e,this.Z_.s_())}remove(){this.Z_.Ju().unsubscribeAll(this),this.Z_.h_().unsubscribeAll(this),this.od.destroy(),this.Z_.destroy(),this.nd.clear(),this.hd.clear(),this.rd.v(),this.ld.v(),this.ed.v()}resize(t,i,s){this.Z_.Jc(t,i,s)}addAreaSeries(t={}){Fe(t.priceFormat);const i=w(y(Ie),Re,t),s=this.Z_.Ao().createSeries("Area",i),e=new xe(s,this,this);return this.nd.set(e,s),this.hd.set(s,e),e}addBaselineSeries(t={}){Fe(t.priceFormat);const i=w(y(Ie),y(Ae),t),s=this.Z_.Ao().createSeries("Baseline",i),e=new xe(s,this,this);return this.nd.set(e,s),this.hd.set(s,e),e}addBarSeries(t={}){Fe(t.priceFormat);const i=w(y(Ie),Ee,t),s=this.Z_.Ao().createSeries("Bar",i),e=new xe(s,this,this);return this.nd.set(e,s),this.hd.set(s,e),e}addCandlestickSeries(t={}){ds(t),Fe(t.priceFormat);const i=w(y(Ie),Oe,t),s=this.Z_.Ao().createSeries("Candlestick",i),e=new Ce(s,this,this);return this.nd.set(e,s),this.hd.set(s,e),e}addHistogramSeries(t={}){Fe(t.priceFormat);const i=w(y(Ie),Le,t),s=this.Z_.Ao().createSeries("Histogram",i),e=new xe(s,this,this);return this.nd.set(e,s),this.hd.set(s,e),e}addLineSeries(t={}){Fe(t.priceFormat);const i=w(y(Ie),Ne,t),s=this.Z_.Ao().createSeries("Line",i),e=new xe(s,this,this);return this.nd.set(e,s),this.hd.set(s,e),e}removeSeries(t){const i=h(this.nd.get(t)),s=this.ed.A_(i);this.Z_.Ao().removeSeries(i),this.ud(s),this.nd.delete(t),this.hd.delete(i)}X_(t,i){this.ud(this.ed.D_(t,i))}K_(t,i){this.ud(this.ed.L_(t,i))}subscribeClick(t){this.rd.subscribe(t)}unsubscribeClick(t){this.rd.unsubscribe(t)}subscribeCrosshairMove(t){this.ld.subscribe(t)}unsubscribeCrosshairMove(t){this.ld.unsubscribe(t)}priceScale(t){return new Ve(this.Z_,t)}timeScale(){return this.od}applyOptions(t){this.Z_.n_(ze(t))}options(){return this.Z_.pu()}takeScreenshot(){return this.Z_.r_()}ud(t){const i=this.Z_.Ao();i.updateTimeScale(t.F_.z_,t.F_.j_,t.F_.H_),t.B_.forEach(((t,i)=>i.setData(t.Cs,t.W_))),i.recalculateAllPanes()}_d(t){return h(this.hd.get(t))}ad(t){const i=new Map;t.w_.forEach(((t,s)=>{const e=Se(s.seriesType())(t);n(function(t){return void 0!==t.open||void 0!==t.value}(e)),i.set(this._d(s),e)}));const s=void 0===t.m_?void 0:this._d(t.m_);return{time:t.yt,logical:t.Wh,point:t.v_,hoveredSeries:s,hoveredMarkerId:t.g_,seriesData:i}}}var je=Object.freeze({__proto__:null,version:function(){return"4.0.0-dev+202206071405"},get LineStyle(){return i},get LineType(){return t},get TrackingModeExitMode(){return ns},get CrosshairMode(){return X},get MismatchDirection(){return gi},get PriceScaleMode(){return Wi},get PriceLineSource(){return rs},get LastPriceAnimationMode(){return hs},get TickMarkType(){return es},get ColorType(){return ls},isBusinessDay:fs,isUTCTimestamp:ps,createChart:function(t,i){let s;if(M(t)){const i=document.getElementById(t);n(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new We(s,i)},DrawingPane:class{constructor(){this.dd=[]}init(t,i){this.series=t,this.model=i;for(const s of this.dd)s.init(t,i)}addChild(t){t.init(this.series,this.model),this.dd.push(t)}removeChild(t){const i=this.dd.indexOf(t);return!(i<0)&&(this.dd.splice(i,1),!0)}render(t){for(const i of this.dd)i.render(t);this.draw(t)}refresh(){this.model.fullUpdate()}timeScale(){return this.model.timeScale()}x(t){return this.timeToCoordinate(t)}y(t){return this.priceToCoordinate(t)}priceScale(){return this.series.priceScale()}timeToIndex(t){return this.timeScale().timeToIndex({timestamp:t},!0)}indexToCoordinate(t){return this.timeScale().indexToCoordinate(t)}timeToCoordinate(t){return this.indexToCoordinate(this.timeToIndex(t))}priceToCoordinate(t){return this.priceScale().priceToCoordinate(t,this.priceScale().firstValue())}}});window.LightweightCharts=je}();
